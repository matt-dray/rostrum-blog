---
title: Tidyverse quiz
author: Matt Dray
date: '2019-03-06'
slug: tidyverse-quiz
categories:
  - R
tags:
  - quiz
  - learnr
  - tidyverse
  - pacman
draft: yes
---



<p>Matt Dray (<a href="https://www.twitter.com/mattdray">@mattdray</a>)</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/matt-dray/tidyverse-quiz/master/images/tidyverse_quiz.gif" />

</div>
<div id="tldr" class="section level1">
<h1>TL;DR</h1>
<p>I made <a href="https://github.com/matt-dray/tidyquiz">{tidyquiz}</a>: a package containing a (niche) multiple-choice quiz to test your ability to match tidyverse functions to their packages. To use it:</p>
<ol style="list-style-type: decimal">
<li>Install the package with <code>remotes::install_github(&quot;matt-dray/tidyquiz&quot;)</code></li>
<li>Call the package with <code>library(tidyquiz)</code></li>
<li>Run <code>tidyquiz::generate_quiz()</code> to generate a question set and open the quiz in your browser question set (re-run for a new question set)</li>
</ol>
</div>
<div id="the-problem" class="section level1">
<h1>The problem</h1>
<p>I saw a (probably) tongue-in-cheek tweet recently from <a href="https://twitter.com/ryantimpe">Ryan Timpe</a>:</p>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Hardest part about <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> package development: remembering which functions are from {dplyr} and which are from {tidyr}.
</p>
â€” Ryan Timpe ðŸ¦–ðŸ“Š (<span class="citation">@ryantimpe</span>) <a href="https://twitter.com/ryantimpe/status/1102666979909996545?ref_src=twsrc%5Etfw">March 4, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Is the purpose of each package in <a href="https://www.tidyverse.org/">the tidyverse</a> clear enough?</p>
<p>Many users will get around this by running <code>library(tidyverse)</code>, which installs the core set of eight tidyverse packages. You can run <code>select()</code> or <code>gather()</code> after that without having to think about whether theyâ€™re part of {dplyr} or {tidyr}.</p>
<p>This made me wonder how good I was at remembering which functions (or previously unseen functions) belong to which packages in the tidyverse. So naturally I thought it would be a fun diversion to create a quiz.</p>
</div>
<div id="package-function-combos" class="section level1">
<h1>Package-function combos</h1>
<p>You can see the {tidyverse} package only loads the eight core packages by default.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## â”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.2.1 â”€â”€</code></pre>
<pre><code>## âœ” ggplot2 3.1.0       âœ” purrr   0.3.1  
## âœ” tibble  2.0.1       âœ” dplyr   0.8.0.1
## âœ” tidyr   0.8.3       âœ” stringr 1.4.0  
## âœ” readr   1.3.1       âœ” forcats 0.4.0</code></pre>
<pre><code>## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
## âœ– dplyr::filter() masks stats::filter()
## âœ– dplyr::lag()    masks stats::lag()</code></pre>
<p>Fortunately thereâ€™s a function that provides the names of all the packages within the tidyverse.</p>
<pre class="r"><code>tidy_pkgs &lt;- tidyverse_packages() %&gt;%  # calls character vector
  # We can protect ourselves from any rogue characters in this vector
  str_replace(&quot;\n&quot;, &quot;&quot;) %&gt;%  # remove newline
  str_replace(&quot;&gt;=&quot;, &quot;&quot;) %&gt;%  # remove greater than or equal to
  str_replace(&quot;[:punct:]&quot;, &quot;&quot;)  # remove punctuation

tidy_pkgs</code></pre>
<pre><code>##  [1] &quot;broom&quot;      &quot;cli&quot;        &quot;crayon&quot;     &quot;dplyr&quot;      &quot;dbplyr&quot;    
##  [6] &quot;forcats&quot;    &quot;ggplot2&quot;    &quot;haven&quot;      &quot;hms&quot;        &quot;httr&quot;      
## [11] &quot;jsonlite&quot;   &quot;lubridate&quot;  &quot;magrittr&quot;   &quot;modelr&quot;     &quot;purrr&quot;     
## [16] &quot;readr&quot;      &quot;readxl&quot;     &quot;reprex&quot;     &quot;rlang&quot;      &quot;rstudioapi&quot;
## [21] &quot;rvest&quot;      &quot;stringr&quot;    &quot;tibble&quot;     &quot;tidyr&quot;      &quot;xml2&quot;      
## [26] &quot;tidyverse&quot;</code></pre>
<p>We can pass this character vector to {pacman}â€™s <code>p_load()</code> to install and load them all.</p>
<pre class="r"><code>library(pacman)

p_load(
  char = tidy_pkgs,
  character.only = TRUE  # read elements of character vector
)</code></pre>
<p>Now we can get the functions from each package by mapping over each with {pacman}â€™s <code>p_functions()</code>.</p>
<pre class="r"><code>tidy_funs &lt;- tidy_pkgs %&gt;% 
  enframe(name = NULL, value = &quot;package&quot;) %&gt;%  # make tibble
  mutate(
    functions = map(
      package,  # for each package name...
      ~p_functions(.x, character.only = TRUE)  # ...get functions
    )
  ) %&gt;% 
  unnest()  # unpack the listcol elements

sample_n(tidy_funs, 10)  # random sample</code></pre>
<pre><code>## # A tibble: 10 x 2
##    package   functions             
##    &lt;chr&gt;     &lt;chr&gt;                 
##  1 ggplot2   is.ggplot             
##  2 readr     format_csv            
##  3 tibble    add_column            
##  4 ggplot2   scale_y_time          
##  5 rlang     is_raw                
##  6 httr      oauth2.0_authorize_url
##  7 lubridate parse_date_time2      
##  8 rlang     quo_expr              
##  9 lubridate hour&lt;-                
## 10 dplyr     summarise_each</code></pre>
<p>Now we just need a function name for the subject of the question, the correct answer and three incorrect answers.</p>
<p>To do this we can:</p>
<ul>
<li>sample a row randomly to get a function name and the package itâ€™s from</li>
<li>sample randomly three other packages that donâ€™t contain that function, ensuring that these are different from each other</li>
</ul>
<p>The annotated code below shows a function that does this.</p>
<pre class="r"><code>get_questions &lt;- function() {
  
  # Randomly sample one row of the tidy_funs tibble
  # Output is a single package-function pair
  fun_sample &lt;- sample_n(tidy_funs, 1)
  
  # Extract just the name of the function
  fun_name &lt;&lt;- select(fun_sample, functions) %&gt;% pull()
  
  # Create lookup of packages that the function is duplicated in
  # Output is a character vector of packages that the function exists in
  dup_lookup &lt;- tidy_funs %&gt;% 
    filter(functions == fun_name) %&gt;% 
    pull(package)
  
  # The correct answer is the one we already isolated
  ans_correct &lt;&lt;- fun_sample %&gt;% select(package) %&gt;% pull()
  
  # Wrong answer 1
  ans_wrong1 &lt;&lt;- tidy_funs %&gt;%
    distinct(package) %&gt;%  # get unique packages
    filter(!package %in% c(dup_lookup)) %&gt;%  # ignore packages containing function
    sample_n(1) %&gt;%  # choose a remaining package name at random
    pull()  # to character
  
  # Wrong answer 2
  ans_wrong2 &lt;&lt;- tidy_funs %&gt;%
    distinct(package) %&gt;%
    filter(!package %in% c(dup_lookup, ans_wrong1)) %&gt;% # also ignore the first wrong answer
    sample_n(1) %&gt;%
    pull()
  
  # Wrong answer 3
  ans_wrong3 &lt;&lt;- tidy_funs %&gt;%
    distinct(package) %&gt;%
    filter(!package %in% c(dup_lookup, ans_wrong1, ans_wrong2)) %&gt;%
    sample_n(1) %&gt;%
    pull()
  
}</code></pre>
<p>Note the use of a slightly different assignment operator with two heads: <code>&lt;&lt;-</code>. This makes the object available in the global environment outside of the function call. From there, the object can be picked up for use in constructing a question that will be presented to the user.</p>
</div>
<div id="using-learnr" class="section level1">
<h1>Using {learnr}</h1>
<p>The <a href="https://rstudio.github.io/learnr/">{learnr} package</a> helps you turn an R Markdown document into an interactive tutorial with a little help from Shiny. You can do things like embed exercises that allow the user to execute code to test their knowledge. It also has a function to create a multiple-choice question, which is exactly what we need.</p>
<p>Having installed the package and <a href="https://rstudio.github.io/learnr/#getting_started">started a {learnr}-flavoured R Markdown</a> we can create a question inside a code chunk like this:</p>
<pre><code># Generate question and answer objects using our function
get_questions()

# Create a {learnr} question using the objects
quiz(
  caption = &quot;Question 1&quot;,
  question(
    paste0(&quot;The function `&quot;, fun_name, &quot;` is from which tidyverse package?&quot;),
    answer(paste0(&quot;{&quot;, ans_correct, &quot;}&quot;), correct = TRUE),
    answer(paste0(&quot;{&quot;, ans_wrong1, &quot;}&quot;)),
    answer(paste0(&quot;{&quot;, ans_wrong2, &quot;}&quot;)),
    answer(paste0(&quot;{&quot;, ans_wrong3, &quot;}&quot;)),
    random_answer_order = TRUE  # answers ordered randomly
  )
)</code></pre>
<p>The output looks like the questions you can see in the gif at the top of this post.</p>
</div>
<div id="regenerating-the-quiz" class="section level1">
<h1>Regenerating the quiz</h1>
<p>I could have rendered the quiz and hosted it online, but this has a big drawback: the functions and packages named in the questions will have been selected randomly, but they will remain the same forever. Thereâ€™s no way to easily generate new questions from within {learnr}.</p>
<p>Instead, I <a href="https://rstudio.github.io/learnr/publishing.html">published the tutorial in a package</a> called <a href="https://github.com/matt-dray/tidyquiz">{tidyquiz}</a>. When you call the package from the library it instructs you to run <code>tidyquiz::generate_quiz()</code> to create and open a quiz in-browser. Running that line again will re-render the document with a new set of randomly-selected questions.</p>
</div>
