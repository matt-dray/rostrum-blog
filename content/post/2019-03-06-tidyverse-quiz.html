---
title: "A tidyverse functions quiz with {learnr}"
author: Matt Dray
date: '2019-03-18'
slug: tidyverse-quiz
categories:
  - R
tags:
  - quiz
  - learnr
  - tidyverse
  - pacman
draft: no
---



<p>Matt Dray (<a href="https://www.twitter.com/mattdray">@mattdray</a>)</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/matt-dray/tidyverse-quiz/master/images/tidyverse_quiz.gif" />

</div>
<div id="tldr" class="section level1">
<h1>TL;DR</h1>
<p>Can you match the tidyverse function to its package? I used <a href="https://rstudio.github.io/learnr/">{learnr}</a> to make <a href="https://github.com/matt-dray/tidyquiz">{tidyquiz}</a> to test you. Run:</p>
<ol style="list-style-type: decimal">
<li><code>remotes::install_github(&quot;matt-dray/tidyquiz&quot;)</code> to install {tidyquiz}</li>
<li><code>library(tidyquiz)</code> to load it</li>
<li><code>learnr::run_tutorial(&quot;tidy&quot;, package = &quot;tidyquiz&quot;)</code> to open in your browser</li>
</ol>
<p>To use:</p>
<ol style="list-style-type: decimal">
<li>In your browser, choose a seed to randomise the question and hit â€˜Goâ€™</li>
<li>Make a selection by clicking an answer and then â€˜Submit Answerâ€™</li>
</ol>
<p>To get a new question:</p>
<ol style="list-style-type: decimal">
<li>Click â€˜Start Overâ€™ in the menu bar</li>
<li>Choose a new seed</li>
<li>Hit â€˜Goâ€™</li>
</ol>
</div>
<div id="the-problem" class="section level1">
<h1>The problem</h1>
<p>I saw a (probably) tongue-in-cheek tweet recently from <a href="https://twitter.com/ryantimpe">Ryan Timpe</a>:</p>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Hardest part about <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> package development: remembering which functions are from {dplyr} and which are from {tidyr}.
</p>
â€” Ryan Timpe ðŸ¦–ðŸ“Š (<span class="citation">@ryantimpe</span>) <a href="https://twitter.com/ryantimpe/status/1102666979909996545?ref_src=twsrc%5Etfw">March 4, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Itâ€™s easy enough to get out of this pickle, but maybe thereâ€™s a deeper problem? What if the purpose of each <a href="https://www.tidyverse.org/">tidyverse</a> isnâ€™t clear enough? Is there too much <a href="https://twitter.com/dnlmc/status/1105973896828866560">arbitrary jargon in the tidyverse?</a>? <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>Enjoy your existential crisis. Meanwhile, Iâ€™ve made a little quiz to see if you can remember whether <code>unnest()</code> is from {dplyr} or {tidyr}<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>. In fact, itâ€™s an interactive multi-choice test that presents you a function from the tidyverse and challenges you to select the correct package.</p>
</div>
<div id="step-0-the-approach" class="section level1">
<h1>Step 0: the approach</h1>
<p>I wanted:</p>
<ol style="list-style-type: decimal">
<li>To get a tidy dataframe of all the tidyverse package-function combos</li>
<li>A user to be presented with an interactive question about one of these tidyverse functions</li>
<li>The ability to generate a new question from within the document</li>
<li>To share this quiz easily, without a server</li>
</ol>
<p>Read the rest of this post to see how I tackled these. Spoilers:</p>
<ol style="list-style-type: decimal">
<li>the <code>tidyverse_packages()</code> function from <a href="https://cran.r-project.org/web/packages/tidyverse/index.html">{tidyverse}</a></li>
<li>the <a href="https://rstudio.github.io/learnr/">{learnr}</a> package</li>
<li>an <a href="http://shiny.rstudio.com/gallery/actionbutton-demo.html"><code>actionButton()</code></a> and Shiny reactivity</li>
<li>you can <a href="https://rstudio.github.io/learnr/publishing.html">put a {learnr} quiz in a package</a> and call it from there!</li>
</ol>
</div>
<div id="step-1-package-function-combos" class="section level1">
<h1>Step 1: package-function combos</h1>
<p>The {tidyverse} package is a package that loads packages.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> Itâ€™s a convenient way to load the eight core packages of the tidyverse.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## â”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.2.1 â”€â”€</code></pre>
<pre><code>## âœ” ggplot2 3.1.0       âœ” purrr   0.3.0  
## âœ” tibble  2.1.1       âœ” dplyr   0.8.0.1
## âœ” tidyr   0.8.3       âœ” stringr 1.4.0  
## âœ” readr   1.3.1       âœ” forcats 0.4.0</code></pre>
<pre><code>## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
## âœ– dplyr::filter() masks stats::filter()
## âœ– dplyr::lag()    masks stats::lag()</code></pre>
<p>But thereâ€™s more than these core eight. To access a list of functions for each package, we first need to load all the packages. We can get a character vector of them all with <code>tidyverse_packages()</code>.</p>
<pre class="r"><code>tidy_pkgs &lt;- tidyverse_packages() %&gt;%  # calls character vector
  # We can protect ourselves from any rogue characters in this vector
  str_replace(&quot;\n&quot;, &quot;&quot;) %&gt;%  # remove newline
  str_replace(&quot;&gt;=&quot;, &quot;&quot;) %&gt;%  # remove greater than or equal to
  str_replace(&quot;[:punct:]&quot;, &quot;&quot;)  # remove punctuation

tidy_pkgs</code></pre>
<pre><code>##  [1] &quot;broom&quot;      &quot;cli&quot;        &quot;crayon&quot;     &quot;dplyr&quot;      &quot;dbplyr&quot;    
##  [6] &quot;forcats&quot;    &quot;ggplot2&quot;    &quot;haven&quot;      &quot;hms&quot;        &quot;httr&quot;      
## [11] &quot;jsonlite&quot;   &quot;lubridate&quot;  &quot;magrittr&quot;   &quot;modelr&quot;     &quot;purrr&quot;     
## [16] &quot;readr&quot;      &quot;readxl&quot;     &quot;reprex&quot;     &quot;rlang&quot;      &quot;rstudioapi&quot;
## [21] &quot;rvest&quot;      &quot;stringr&quot;    &quot;tibble&quot;     &quot;tidyr&quot;      &quot;xml2&quot;      
## [26] &quot;tidyverse&quot;</code></pre>
<p>We can pass this character vector to <code>p_load()</code>. This convenient function from [{pacman}](<a href="https://cran.r-project.org/web/packages/pacman/vignettes/Introduction_to_pacman.html">{pacman}</a> installs and loads them all for us.</p>
<pre class="r"><code>library(pacman)

p_load(
  char = tidy_pkgs,
  character.only = TRUE  # read elements of character vector
)</code></pre>
<p>Now we can get the functions from each package by mapping over them with <a href="https://purrr.tidyverse.org/">{purrr}</a> and {pacman}â€™s <code>p_functions()</code>.</p>
<pre class="r"><code>tidy_funs &lt;- tidy_pkgs %&gt;% 
  enframe(name = NULL, value = &quot;package&quot;) %&gt;%  # make tibble
  mutate(
    functions = map(
      package,  # for each package...
      ~p_functions(.x, character.only = TRUE)  # ...get the functions within
    )
  ) %&gt;% 
  unnest()  # unpack the listcol elements</code></pre>
<p>Hereâ€™s a small sample:</p>
<pre class="r"><code>sample_n(tidy_funs, 10)  # random sample</code></pre>
<pre><code>## # A tibble: 10 x 2
##    package functions       
##    &lt;chr&gt;   &lt;chr&gt;           
##  1 ggplot2 guides          
##  2 dbplyr  build_sql       
##  3 tibble  trunc_mat       
##  4 readr   write_tsv       
##  5 dbplyr  base_odbc_scalar
##  6 httr    guess_media     
##  7 rlang   inherits_all    
##  8 crayon  black           
##  9 xml2    xml_find_lgl    
## 10 rlang   error_cnd</code></pre>
<p>Out of interest we can look at the packages with the most and fewest functions:</p>
<pre class="r"><code>count(tidy_funs, package, sort = TRUE) %&gt;% slice(1:5)</code></pre>
<pre><code>## # A tibble: 5 x 2
##   package       n
##   &lt;chr&gt;     &lt;int&gt;
## 1 rlang       468
## 2 ggplot2     456
## 3 dplyr       258
## 4 lubridate   212
## 5 purrr       177</code></pre>
<pre class="r"><code>count(tidy_funs, package) %&gt;% arrange(n) %&gt;% slice(1:5)</code></pre>
<pre><code>## # A tibble: 5 x 2
##   package       n
##   &lt;chr&gt;     &lt;int&gt;
## 1 tidyverse     5
## 2 reprex        6
## 3 hms           7
## 4 broom        10
## 5 readxl       13</code></pre>
<p>Another source of confusion might be that some functions exist in multiple packages. How many functions?</p>
<pre class="r"><code>count(tidy_funs, functions, sort = TRUE) %&gt;% filter(n &gt; 1) %&gt;% nrow()</code></pre>
<pre><code>## [1] 95</code></pre>
<p>Okay, we have our dataset, so letâ€™s get quizzical.</p>
</div>
<div id="step-2-interactive-questions-with-learnr" class="section level1">
<h1>Step 2: interactive questions with {learnr}</h1>
<p>The <a href="https://rstudio.github.io/learnr/">{learnr} package</a> helps you turn an R Markdown document into an interactive tutorial with a little help from Shiny. One option is to create a multiple-choice question, which is exactly what we need.</p>
<p>I should say that {learnr} wasnâ€™t really intended for what Iâ€™ve done â€“ itâ€™s better suited to longform tutorials â€“ but using it means that I didnâ€™t have to write the logic for a multi-choice quiz question. Shrug.</p>
<p>Having installed the package and <a href="https://rstudio.github.io/learnr/#getting_started">started a {learnr}-flavoured R Markdown</a><a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> we can create a question inside a code chunk in this form:</p>
<pre class="r"><code>quiz(
  caption = &quot;Question 1&quot;,
  question(
    text = &quot;What is Pokemon #399?&quot;,  # question
    answer(&quot;Bidoof&quot;), correct = TRUE),  # right answer
    answer(&quot;Drifloom&quot;),   # wrong
    answer(&quot;Pyukumuku&quot;),  # wrong
    answer(&quot;Rayquaza&quot;),   # wrong
    random_answer_order = TRUE  # answers ordered randomly
  )
)</code></pre>
<p>But this example is hardcoded. In our case we want to replace the subject of the question and the answers any time we want to be presented with a new question.</p>
<p>Looks like weâ€™ll need a button for users to press to signal that they want a new question.</p>
</div>
<div id="step-3-generate-new-questions-with-shiny" class="section level1">
<h1>Step 3: generate new questions with Shiny</h1>
<p>Since {learnr} operates in a Shiny runtime in our R Markdown file, itâ€™s no problem to use Shinyâ€™s <code>actionButton()</code>. Press it and get a new question.</p>
<p>We could leave it at that, but I thought it would be interesting for the user input <a href="http://rfunction.com/archives/62">a seed value that could be used to recreate the sampling outputs</a>. For example, typing the seed â€˜8008â€™ will present you with the same question every time. This means you can refer a particularly fiendish question to a friend by its seed value.</p>
<pre class="r"><code>numericInput(&quot;n&quot;, &quot;Set seed:&quot;, value = 1337)  # user selects a seed
actionButton(&quot;goButton&quot;, &quot;Go&quot;)  # button</code></pre>
<p>To make this reactive â€“ so that nothign will happen until the button is pressed â€“ we can write Shiny server code in an R Markdown chunk by setting <code>context=&quot;server&quot;</code> in the chunk options.</p>
<p>What do we do if we want to click the button and generate a quiz question?</p>
<p>First, our code needs to sample a row from the full dataframe of package-function combos and isolate the name of the function the user will be quizzed on. This code is within <code>eventReactive()</code> and will only trigger when the button has been activated. Second, we use <code>renderText()</code> to take the function name and paste it into a string to create our question.</p>
<pre class="r"><code># Set the reactive element
fun_name &lt;- eventReactive(
  input$goButton,  # on input
  { 
    set.seed(input$n)  # put the user&#39;s input value into set.seed()
    fun_sample &lt;- sample_n(tidy_funs, 1)  # sample a package-function combo
    fun_name &lt;- select(fun_sample, functions) %&gt;% pull()  # get the function name
    return(fun_name)  # return the package value
  }
)

# Set the output
# Generate a question that includes the sampled function name 
output$fun_name_out &lt;- renderText({
  paste0(&quot;The function `&quot;, fun_name(), &quot;` is from which tidyverse package?&quot;)
})</code></pre>
<p>We can repeat this for getting the right answer and alter the code slightly to generate a few wrong answers. A wrong answer is selected randomly from the dataframe of tidyverse functions, but only once the correct answer has been removed. Iâ€™ve also coded it so that any package that has a function with the same name â€“ a conflict â€“ will also be removed before a â€˜wrongâ€™ answer is chosen.</p>
<p>So rather than the hardcoded example of a multi-choice question in Step 2, our quiz question code will look like this:</p>
<pre class="r"><code>quiz(
  caption = &quot;Question &quot;,
  question(
    text = as.character(textOutput(&quot;fun_name_out&quot;)),
    answer(as.character(textOutput(&quot;ans_correct_out&quot;)), correct = TRUE),
    answer(as.character(textOutput(&quot;ans_wrong1_out&quot;))),
    answer(as.character(textOutput(&quot;ans_wrong2_out&quot;))),
    answer(as.character(textOutput(&quot;ans_wrong3_out&quot;))),
    random_answer_order = TRUE
  )
)</code></pre>
<p>So now the text outputs will be rendered into the quiz question and this wonâ€™t change until the seed is changed and the â€˜Goâ€™ button is clicked.</p>
<p>Actually, thatâ€™s sort-of a lie. {learnr} remembers how itâ€™s users have performed; it saves their progress. To erase this, we need to click â€˜Start Overâ€™ from the menu pane to clear that memory.</p>
</div>
<div id="get-the-code" class="section level1">
<h1>Get the code</h1>
<p>Browse the code <a href="https://github.com/matt-dray/tidyquiz">on GitHub</a> and <a href="https://github.com/matt-dray/tidyquiz/issues">leave an issue</a> with thoughts or suggestions.</p>
<p>For example, it could definitely be improved if the user got a set of 10 questions that were graded to give a final mark. Maybe Iâ€™ll implement this one day.</p>
<p>For now, give it a go and let me know if you ever find out if <code>drop_na()</code> is in {dplyr} or {tidyr}.<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a></p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>To get around this, loading {tidyverse} loads the â€˜coreâ€™ tidyverse packages at once. You can run <code>select()</code> or <code>gather()</code> after this without having to think about whether theyâ€™re part of {dplyr} or {tidyr}.<a href="#fnref1">â†©</a></p></li>
<li id="fn2"><p>Am I tricking you? Is it actually from neither?<a href="#fnref2">â†©</a></p></li>
<li id="fn3"><p>The meme writes itself. Or rather, <a href="https://imgflip.com/memegenerator/Yo-Dawg-Heard-You">you can do it for me</a>.<a href="#fnref3">â†©</a></p></li>
<li id="fn4"><p>After installing {learnr} you can go to new R Markdown &gt; From Template &gt; Interactive Tutorial.<a href="#fnref4">â†©</a></p></li>
<li id="fn5"><p>Am I tricking you? Is it actually from neither?<a href="#fnref5">â†©</a></p></li>
</ol>
</div>
