---
title: "Quiz: do you know tidyverse functions?"
author: Matt Dray
date: '2019-03-06'
slug: tidyverse-quiz
categories:
  - R
tags:
  - quiz
  - learnr
  - tidyverse
  - pacman
draft: yes
---



<p>Matt Dray (<a href="https://www.twitter.com/mattdray">@mattdray</a>)</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/matt-dray/tidyverse-quiz/master/images/tidyverse_quiz.gif" />

</div>
<div id="tldr" class="section level1">
<h1>TL;DR</h1>
<p>I made <a href="https://github.com/matt-dray/tidyquiz">{tidyquiz}</a>: a package containing a (niche) multiple-choice quiz to test your ability to match tidyverse functions to their packages. To use it:</p>
<ol style="list-style-type: decimal">
<li>Install the package with <code>remotes::install_github(&quot;matt-dray/tidyquiz&quot;)</code></li>
<li>Call the package with <code>library(tidyquiz)</code></li>
<li>Run <code>learnr::run_tutorial(&quot;tidy&quot;, package = &quot;tidyquiz&quot;)</code> to open in your browser</li>
</ol>
</div>
<div id="the-problem" class="section level1">
<h1>The problem</h1>
<p>I saw a (probably) tongue-in-cheek tweet recently from <a href="https://twitter.com/ryantimpe">Ryan Timpe</a>:</p>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Hardest part about <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> package development: remembering which functions are from {dplyr} and which are from {tidyr}.
</p>
â€” Ryan Timpe ðŸ¦–ðŸ“Š (<span class="citation">@ryantimpe</span>) <a href="https://twitter.com/ryantimpe/status/1102666979909996545?ref_src=twsrc%5Etfw">March 4, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Is the purpose of each package in <a href="https://www.tidyverse.org/">the tidyverse</a> clear enough?</p>
<p>Many users will get around this by running <code>library(tidyverse)</code>, which installs the core set of eight tidyverse packages. You can run <code>select()</code> or <code>gather()</code> after that without having to think about whether theyâ€™re part of {dplyr} or {tidyr}.</p>
<p>This made me wonder how good I was at remembering which functions (or previously unseen functions) belong to which packages in the tidyverse. So naturally I thought it would be a fun diversion to test myself. i also wanted to see whether functions in the {learnr} package could help me do it.</p>
</div>
<div id="step-0-the-approach" class="section level1">
<h1>Step 0: the approach</h1>
<p>I wanted:</p>
<ol style="list-style-type: decimal">
<li>to get all the package-function combos in the tidyverse</li>
<li>a user to be presented with an interactive question about a tidyverse function</li>
<li>the ability to generate a new question from within the document</li>
</ol>
<p>These are solved by using the functions <code>tidyverse::tidyverse_packages()</code> and <code>pacman::p_functions()</code>; {learnr}â€™s solution for interactive multiple-choice questions in an R Markdown document; and a dollop of additional Shiny, which can operate in the Shiny-runtime of the R Markdown. The sections below go into this in more detail.</p>
</div>
<div id="step-1-package-function-combos" class="section level1">
<h1>Step 1: package-function combos</h1>
<p>You can see the {tidyverse} package only loads the eight core packages by default.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## â”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.2.1 â”€â”€</code></pre>
<pre><code>## âœ” ggplot2 3.1.0       âœ” purrr   0.3.1  
## âœ” tibble  2.0.1       âœ” dplyr   0.8.0.1
## âœ” tidyr   0.8.3       âœ” stringr 1.4.0  
## âœ” readr   1.3.1       âœ” forcats 0.4.0</code></pre>
<pre><code>## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
## âœ– dplyr::filter() masks stats::filter()
## âœ– dplyr::lag()    masks stats::lag()</code></pre>
<p>Fortunately thereâ€™s a function that provides the names of all the packages within the tidyverse.</p>
<pre class="r"><code>tidy_pkgs &lt;- tidyverse_packages() %&gt;%  # calls character vector
  # We can protect ourselves from any rogue characters in this vector
  str_replace(&quot;\n&quot;, &quot;&quot;) %&gt;%  # remove newline
  str_replace(&quot;&gt;=&quot;, &quot;&quot;) %&gt;%  # remove greater than or equal to
  str_replace(&quot;[:punct:]&quot;, &quot;&quot;)  # remove punctuation

tidy_pkgs</code></pre>
<pre><code>##  [1] &quot;broom&quot;      &quot;cli&quot;        &quot;crayon&quot;     &quot;dplyr&quot;      &quot;dbplyr&quot;    
##  [6] &quot;forcats&quot;    &quot;ggplot2&quot;    &quot;haven&quot;      &quot;hms&quot;        &quot;httr&quot;      
## [11] &quot;jsonlite&quot;   &quot;lubridate&quot;  &quot;magrittr&quot;   &quot;modelr&quot;     &quot;purrr&quot;     
## [16] &quot;readr&quot;      &quot;readxl&quot;     &quot;reprex&quot;     &quot;rlang&quot;      &quot;rstudioapi&quot;
## [21] &quot;rvest&quot;      &quot;stringr&quot;    &quot;tibble&quot;     &quot;tidyr&quot;      &quot;xml2&quot;      
## [26] &quot;tidyverse&quot;</code></pre>
<p>We can pass this character vector to {pacman}â€™s <code>p_load()</code> to install and load them all.</p>
<pre class="r"><code>library(pacman)

p_load(
  char = tidy_pkgs,
  character.only = TRUE  # read elements of character vector
)</code></pre>
<p>Now we can get the functions from each package by mapping over each with {pacman}â€™s <code>p_functions()</code>.</p>
<pre class="r"><code>tidy_funs &lt;- tidy_pkgs %&gt;% 
  enframe(name = NULL, value = &quot;package&quot;) %&gt;%  # make tibble
  mutate(
    functions = map(
      package,  # for each package name...
      ~p_functions(.x, character.only = TRUE)  # ...get functions
    )
  ) %&gt;% 
  unnest()  # unpack the listcol elements</code></pre>
<p>Hereâ€™s a small sample:</p>
<pre class="r"><code>sample_n(tidy_funs, 10)  # random sample</code></pre>
<pre><code>## # A tibble: 10 x 2
##    package   functions                
##    &lt;chr&gt;     &lt;chr&gt;                    
##  1 rlang     new_character            
##  2 ggplot2   coord_cartesian          
##  3 readr     parse_integer            
##  4 ggplot2   geom_curve               
##  5 ggplot2   scale_linetype_continuous
##  6 readr     show_progress            
##  7 dplyr     check_dbplyr             
##  8 rlang     vec_poke_n               
##  9 httr      stop_for_status          
## 10 lubridate is.Date</code></pre>
<p>Out of interest we can look at the packages with the most and fewest functions:</p>
<pre class="r"><code>most_pkgs &lt;- group_by(tidy_funs, package) %&gt;% count()

arrange(most_pkgs, desc(n))</code></pre>
<pre><code>## # A tibble: 26 x 2
## # Groups:   package [26]
##    package        n
##    &lt;chr&gt;      &lt;int&gt;
##  1 rlang        468
##  2 ggplot2      456
##  3 dplyr        258
##  4 lubridate    212
##  5 purrr        177
##  6 dbplyr       112
##  7 readr        109
##  8 httr          91
##  9 rstudioapi    83
## 10 xml2          66
## # â€¦ with 16 more rows</code></pre>
<pre class="r"><code>arrange(most_pkgs, n)</code></pre>
<pre><code>## # A tibble: 26 x 2
## # Groups:   package [26]
##    package       n
##    &lt;chr&gt;     &lt;int&gt;
##  1 tidyverse     5
##  2 reprex        6
##  3 hms           7
##  4 broom        10
##  5 readxl       13
##  6 cli          16
##  7 jsonlite     22
##  8 haven        27
##  9 rvest        29
## 10 forcats      32
## # â€¦ with 16 more rows</code></pre>
<p>Great. How we can turn this into an interactive multiple-choice question?</p>
</div>
<div id="step-2-interactive-questions-with-learnr" class="section level1">
<h1>Step 2: interactive questions with {learnr}</h1>
<p>The <a href="https://rstudio.github.io/learnr/">{learnr} package</a> helps you turn an R Markdown document into an interactive tutorial with a little help from Shiny. You can do things like embed exercises that allow the user to execute code to test their knowledge. It also has a function to create multiple-choice questions, which is exactly what we need.</p>
<p>Having installed the package and <a href="https://rstudio.github.io/learnr/#getting_started">started a {learnr}-flavoured R Markdown</a> we can create a question inside a code chunk in this form:</p>
<pre class="r"><code>quiz(
  caption = &quot;Question 1&quot;,
  question(
    text = &quot;What is Pokemon #399?&quot;,  # question
    answer(&quot;Bidoof&quot;), correct = TRUE),  # right answer
    answer(&quot;Drifloom&quot;),   # wrong
    answer(&quot;Pyukumuku&quot;),  # wrong
    answer(&quot;Rayquaza&quot;),   # wrong
    random_answer_order = TRUE  # answers ordered randomly
  )
)</code></pre>
<p>Notice that this example is hardcoded. This is fine in a regular tutorial, but in our case we want to replace the subject of the question and the answers whenever we sample a new tidyverse function.</p>
<p>Since {learnr} operates in a Shiny runtime in our R Markdown file anyway, we can create a Shiny button that a user can click to generate a new question.</p>
</div>
<div id="step-3-generate-questions-with-shiny" class="section level1">
<h1>Step 3: generate questions with Shiny</h1>
<p>Rather than generate a random question when a button is pressed, the user inputs a value that will be used in the <code>set.seed()</code> function and presses â€˜Goâ€™. This function makes sampling repeatable. In other words, the user will get the same question if they use the same seed. This lets people return to, or share, particularly tricky questions.</p>
<pre class="r"><code>numericInput(&quot;n&quot;, &quot;Set seed:&quot;, value = 1337)
actionButton(&quot;goButton&quot;, &quot;Go&quot;)</code></pre>
<p>We can then ensure that triggering the action button forces rendering of the text that will make up the question and the answers.</p>
<p>This example is for constructing the question to include the randomly-selected function. We repeat this for the correct answer and for three wrong answers.</p>
<pre class="r"><code># This takes place in an R Markdown chunk with
# context=&quot;server&quot; in the chunk options

# Set the reactive element
fun_name &lt;- eventReactive(
  input$goButton,  # on input
  { 
    set.seed(input$n)  # put the input value in set.seed()
    fun_sample &lt;- sample_n(tidy_funs, 1)  # sample a package-function combo
    fun_name &lt;- select(fun_sample, functions) %&gt;% pull()  # just the function
    return(fun_name)  # return the package value
  }
)

# Set the output
# Generate a question that includes the sampled function name 
output$fun_name_out &lt;- renderText({
  paste0(&quot;The function `&quot;, fun_name(), &quot;` is from which tidyverse package?&quot;)
})</code></pre>
<p>So rather than the hardcoded example of a multi-choice question in Step 2, we have something like this instead:</p>
<pre class="r"><code>quiz(
  caption = &quot;Question &quot;,
  question(
    text = as.character(textOutput(&quot;fun_name_out&quot;)),
    answer(as.character(textOutput(&quot;ans_correct_out&quot;)), correct = TRUE),
    answer(as.character(textOutput(&quot;ans_wrong1_out&quot;))),
    answer(as.character(textOutput(&quot;ans_wrong2_out&quot;))),
    answer(as.character(textOutput(&quot;ans_wrong3_out&quot;))),
    random_answer_order = TRUE
  )
)</code></pre>
<p>So now the text outputs will be rendered into the quiz question. Since these are reactive, it means they wonâ€™t change until the â€˜Goâ€™ button is clicked.</p>
<p>Browse the code <a href="https://github.com/matt-dray/tidyquiz">on GitHub</a> and <a href="https://github.com/matt-dray/tidyquiz/issues">leave an issue</a> with thoughts or suggestions.</p>
</div>
