---
title: Art of the Possible
author: Matt Dray
date: '2018-11-01'
slug: art-of-the-possible
draft: yes
---



<p>Matt Dray</p>
<div id="search-by-colour" class="section level1">
<h1>Search by colour</h1>
<p>You can search a collection of images by their colour content, ordering them by that colour’s dominance in each image. Some examples:</p>
<ul>
<li><a href="https://artsexperiments.withgoogle.com/artpalette/colors/a46053-433932-c2ad8f-b5996a-746251">Google Arts &amp; Culture</a></li>
<li><a href="https://www.designspiration.net/search/saves/?q=%2389ebd7%20%23afff11%20%23e5ff91%20%23ff9775%20%23f38d00">Designspiration</a></li>
<li><a href="https://labs.tineye.com/multicolr/">TinEye Multicolr</a></li>
<li><a href="https://www.google.co.uk/advanced_image_search">Google Advanced Image Search</a></li>
<li><a href="https://www.dulux.co.uk/en/articles/dulux-visualizer-app">Dulux colour match</a></li>
</ul>
<p>Could we do something similar to this in R?</p>
</div>
<div id="quick-note-on-colours" class="section level1">
<h1>Quick note on colours</h1>
<p>There are <em>lots</em> of colours. To keep things simple, let’s say ‘green’ instead of olive drab.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>Also I’m colourblind so don’t believe anything I say.</p>
</div>
<div id="the-process" class="section level1">
<h1>The process</h1>
<p>So what we need to do is:</p>
<ol style="list-style-type: decimal">
<li>Read in an image</li>
<li>Map a set of simplified colours to that image</li>
<li>Quantify the colours</li>
</ol>
</div>
<div id="its-a-kind-of-imagemagick" class="section level1">
<h1>It’s a kind of ImageMagick</h1>
<p>The <code>magick</code> R package is an implementation of <a href="https://www.imagemagick.org/script/index.php">ImageMagick, an open-source software suite whose emphasis is image manipulation from the command line</a>. The flexibility of <code>magick</code> can be seen in the <a href="https://cran.r-project.org/web/packages/magick/vignettes/intro.html">vignette</a>.</p>
<p><code>magick</code> was created and is maintained by <a href="https://twitter.com/opencpu?lang=en">Jeroen Ooms</a>, a software engineer and postdoc at <a href="https://ropensci.org/">ROpenSci</a>, a collective that seeks <a href="https://ropensci.org/packages/">to develop tools for open and reproducible research</a>.</p>
<p><a href="https://ropensci.org/blog/2018/10/24/commcall-nov2018/">ROpenSci hosted recently a worjshop from Ooms about working with images in R</a>, which caught my attention.</p>
<pre class="r"><code># Simplify image colours to prespecified simple colour set
# Following Jeroen Ooms (https://jeroen.github.io/munster2018/)

library(magick)</code></pre>
<pre><code>## Linking to ImageMagick 6.9.9.39
## Enabled features: cairo, fontconfig, freetype, lcms, pango, rsvg, webp
## Disabled features: fftw, ghostscript, x11</code></pre>
<pre class="r"><code>library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>library(tibble)

# read test image

# img_path &lt;- &quot;https://upload.wikimedia.org/wikipedia/commons/1/13/Suprematist_Composition_-_Kazimir_Malevich.jpg&quot;
img_path &lt;- &quot;https://www.mchampetier.com/sitephp/images/hd/9zy_Joan_Miro_oct176.jpg&quot;

test_img &lt;- magick::image_read(
  img_path
) %&gt;%  # read image as a magick class object
  image_scale(geometry = c(&quot;x250&quot;))  # resize to width of 250px

# Generate named vector of &#39;simple&#39; colours

cols_vec &lt;- setNames(
  c(&quot;#000000&quot;, &quot;#0000ff&quot;, &quot;#008000&quot;, &quot;#ff0000&quot;, &quot;#ffffff&quot;, &quot;#ffff00&quot;),
  c(&quot;black&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;red&quot;, &quot;white&quot;, &quot;yellow&quot;)
)

# For each vector element (colour) create a square of that colour

for (i in seq_along(cols_vec)) {
  fig_name &lt;- paste0(names(cols_vec)[i], &quot;_square&quot;)  # create object name
  assign(
    fig_name,  # set name
    image_graph(width = 100, height = 100, res = 300)  # create magick object
  )
  par(mar = rep(0, 4))  # set plot margins
  plot.new()  # new graphics frame
  rect(0, 0, 1, 1, col = cols_vec[i], border = cols_vec[i])  # build rectangle
  assign(fig_name, magick::image_crop(get(fig_name), &quot;50x50+10+10&quot;)) # crop
  dev.off()  # shut down plotting device
  rm(i, fig_name)  # clear up
}

# Generate names of the coloure dsquare objects

col_square &lt;- paste0(names(cols_vec), &quot;_square&quot;)

# Combine magick objects (coloured squares)

simple_cols &lt;- image_append(c(
    get(col_square[1]),
    get(col_square[2]),
    get(col_square[3]),
    get(col_square[4]),
    get(col_square[5]),
    get(col_square[6])
  ))

# Map the simple colours to the image

img_mapped &lt;- image_map(test_img, simple_cols)

# Display the original and simplified images side by side

image_append(c(test_img, img_mapped))</code></pre>
<p><img src="/post/2018-11-01-art-of-the-possible_files/figure-html/unnamed-chunk-1-1.png" width="406" /></p>
<pre class="r"><code># Function to count the colours (adapted from Jeroen Ooms)

count_colors &lt;- function(image) {
  data &lt;- image_data(image) %&gt;%
    apply(2:3, paste, collapse = &quot;&quot;) %&gt;% 
    as.vector %&gt;% table() %&gt;%  as.data.frame() %&gt;% 
    setNames(c(&quot;hex&quot;, &quot;freq&quot;))
  data$hex &lt;- paste(&quot;#&quot;, data$hex, sep=&quot;&quot;)
  return(data)
}

# Dataframe of dominant colours 

col_freq &lt;- img_mapped %&gt;%
  count_colors() %&gt;%
  left_join(
    as_tibble(cols_vec) %&gt;%
      rownames_to_column() %&gt;%
      rename(hex = value, name = rowname),
    by = &quot;hex&quot;
  ) %&gt;% 
  arrange(desc(freq)) %&gt;% 
  mutate(percent = freq/sum(freq)) %&gt;% 
  select(name, hex, freq, percent)

col_freq</code></pre>
<pre><code>##     name     hex  freq    percent
## 1 yellow #ffff00 32974 0.32486700
## 2  white #ffffff 31232 0.30770443
## 3    red #ff0000 11645 0.11472906
## 4  black #000000 11643 0.11470936
## 5   blue #0000ff  7690 0.07576355
## 6  green #008000  6316 0.06222660</code></pre>
</div>
<div id="session-info" class="section level1">
<h1>Session info</h1>
<pre class="r"><code>devtools::session_info()</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>There are <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">five named shares of olive drab</a> in R.]<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
