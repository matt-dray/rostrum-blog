---
title: The Mountain Goats with {trelliscopejs}
author: Matt Dray
date: '2019-06-19'
slug: goat-scope
categories:
  - R
  - dataviz
tags:
  - trelliscopejs
  - trelliscope
  - small multiples
draft: yes
---



<div id="small-multiples" class="section level1">
<h1>Small multiples</h1>
<p>The <a href="">{trelliscopejs}</a> package by <a href="">Ryan Hafen</a> harnesses the power of his <a href="">trelliscope.js</a> JavaScript library for R.</p>
<p>What does it do? It provides an interactive interface for organising and exploring visualisations of small mulitples.</p>
<p>What’s a ‘small multiple’? Rather than overplotting data for multiple levels of some variable, you can facet by them and display the outputs side by side for easy comparison.</p>
<p>Ryan has written <a href="">guidance</a> and provided examples in posts using data on <a href="">x</a>, <a href="">Pokemon</a> and <a href="">Instagram</a>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> His package is relatively simple to use and does a lot of legwork for you to provide a nice interface to your data.</p>
</div>
<div id="goat-discography" class="section level1">
<h1>Goat discography</h1>
<p>In a previous post I used the {spotifyr}, {genius} and {markovifyR} packages to generate new lyrics for the band The Mountain Goats.</p>
<p>The data from Spotify is interesting. It has musical information like key and tempo, but also audio features like ‘danceability’ and ‘acousticness’ scaled from 0 to 1. We also got links to album art in that dataset.</p>
<p>I’m going to use these data in this post to provide a Trelliscope example.</p>
</div>
<div id="ready-the-data" class="section level1">
<h1>Ready the data</h1>
<p>We’ll load {trelliscopejs} and some <a href="">tidyverse packages</a> to help us out.</p>
<pre class="r"><code>library(trelliscopejs)
library(dplyr)  # manipulate data
library(readr)  # read data
library(tidyr) # get data into tidy form</code></pre>
<div id="get-data-and-simplify" class="section level2">
<h2>Get data and simplify</h2>
<p>You can follow the instructions in the previous post to get the data. I’m going to load those data from an RDS file on my machine.</p>
<pre class="r"><code>raw_goat &lt;- read_rds(&quot;~/Desktop/goat_discography.RDS&quot;)
dim(raw_goat)</code></pre>
<pre><code>## [1] 399  41</code></pre>
<p>It’s a pretty large data set, so let’s simplify.</p>
<pre class="r"><code>small_goat &lt;- raw_goat %&gt;% 
  unnest(available_markets) %&gt;%  # unnest character vector
  filter(available_markets == &quot;US&quot;) %&gt;%  # releases from one country only
  select(
    track_name, album_name, track_n, album_release_year,  # track detail
    danceability, energy, speechiness, acousticness,  # audio features
    instrumentalness, liveness, valence  # audio features
  ) %&gt;%
  arrange(energy)  # order by &#39;energy&#39; audio feature

glimpse(small_goat)</code></pre>
<pre><code>## Observations: 313
## Variables: 11
## $ track_name         &lt;chr&gt; &quot;Whole Wide World&quot;, &quot;Have To Explode&quot;, &quot;Talla…
## $ album_name         &lt;chr&gt; &quot;Sweden&quot;, &quot;Tallahassee&quot;, &quot;Tallahassee&quot;, &quot;The …
## $ track_n            &lt;int&gt; 6, 11, 1, 10, 12, 10, 1, 6, 4, 7, 9, 8, 9, 11…
## $ album_release_year &lt;dbl&gt; 1995, 2002, 2002, 2009, 2009, 2002, 2009, 200…
## $ danceability       &lt;dbl&gt; 0.649, 0.634, 0.585, 0.470, 0.374, 0.713, 0.7…
## $ energy             &lt;dbl&gt; 0.0335, 0.0498, 0.0535, 0.0669, 0.0669, 0.069…
## $ speechiness        &lt;dbl&gt; 0.0698, 0.0543, 0.0423, 0.0557, 0.0374, 0.045…
## $ acousticness       &lt;dbl&gt; 0.894, 0.886, 0.903, 0.930, 0.971, 0.944, 0.6…
## $ instrumentalness   &lt;dbl&gt; 8.77e-01, 6.51e-02, 4.72e-02, 1.36e-03, 3.26e…
## $ liveness           &lt;dbl&gt; 0.0905, 0.1110, 0.1110, 0.0996, 0.0938, 0.107…
## $ valence            &lt;dbl&gt; 0.2860, 0.2860, 0.1360, 0.2230, 0.0909, 0.209…</code></pre>
</div>
<div id="album-artwork" class="section level2">
<h2>Album artwork</h2>
<p>Unnesting the <code>available_markets</code> character vector removed the <code>album_image</code> variable, which is a nested dataframe with URLs to different-sized album artwork. We can grab unique album image URLs and join them back to our dataset.</p>
<pre class="r"><code>goat_pics &lt;- raw_goat %&gt;%
  unnest(album_images) %&gt;%  # unnest dataframe fo URLs
  filter(width == 640) %&gt;%  # just the largest images
  select(album_name, url) %&gt;%  # simplify dataset
  distinct(album_name, .keep_all = TRUE)  # one unique entry per album

glimpse(goat_pics)</code></pre>
<pre><code>## Observations: 21
## Variables: 2
## $ album_name &lt;chr&gt; &quot;In League with Dragons&quot;, &quot;Goths&quot;, &quot;Beat the Champ&quot;, …
## $ url        &lt;chr&gt; &quot;https://i.scdn.co/image/3896e2b47b548a33d0c9e9f66201…</code></pre>
<p>And now to join the album image URLs back to our simplified dataset.</p>
<pre class="r"><code>small_goat_pics &lt;- left_join(
  x = small_goat,
  y = goat_pics,
  by = &quot;album_name&quot;
)

glimpse(small_goat_pics)</code></pre>
<pre><code>## Observations: 313
## Variables: 12
## $ track_name         &lt;chr&gt; &quot;Whole Wide World&quot;, &quot;Have To Explode&quot;, &quot;Talla…
## $ album_name         &lt;chr&gt; &quot;Sweden&quot;, &quot;Tallahassee&quot;, &quot;Tallahassee&quot;, &quot;The …
## $ track_n            &lt;int&gt; 6, 11, 1, 10, 12, 10, 1, 6, 4, 7, 9, 8, 9, 11…
## $ album_release_year &lt;dbl&gt; 1995, 2002, 2002, 2009, 2009, 2002, 2009, 200…
## $ danceability       &lt;dbl&gt; 0.649, 0.634, 0.585, 0.470, 0.374, 0.713, 0.7…
## $ energy             &lt;dbl&gt; 0.0335, 0.0498, 0.0535, 0.0669, 0.0669, 0.069…
## $ speechiness        &lt;dbl&gt; 0.0698, 0.0543, 0.0423, 0.0557, 0.0374, 0.045…
## $ acousticness       &lt;dbl&gt; 0.894, 0.886, 0.903, 0.930, 0.971, 0.944, 0.6…
## $ instrumentalness   &lt;dbl&gt; 8.77e-01, 6.51e-02, 4.72e-02, 1.36e-03, 3.26e…
## $ liveness           &lt;dbl&gt; 0.0905, 0.1110, 0.1110, 0.0996, 0.0938, 0.107…
## $ valence            &lt;dbl&gt; 0.2860, 0.2860, 0.1360, 0.2230, 0.0909, 0.209…
## $ url                &lt;chr&gt; &quot;https://i.scdn.co/image/ee95286d8fc0c80802ed…</code></pre>
<p>So the album artwork URL has been added to the <code>url</code> column.</p>
</div>
<div id="prep-for-trelliscope" class="section level2">
<h2>Prep for Trelliscope</h2>
<p>This gives us a nice tidy dataframe, but I’m going to make a couple more changes to prepare the data for Trelliscope. First, I need to use the <code>img_panel()</code> function to declare that the album images should be the thing being visualised. Then I can rename the variables to make them look nicer when displayed.</p>
<pre class="r"><code>prepared_goat &lt;- small_goat_pics %&gt;% 
  mutate(panel = img_panel(url)) %&gt;%  # identify as viz for panel
  rename_all(tools::toTitleCase) %&gt;%  # first letter capitalised
  rename(
    Track = Track_name,
    Album = Album_name,
    `Track #` = Track_n,
    Year = Album_release_year
  ) %&gt;% 
  select(-Url)  # discard unneeded variable</code></pre>
</div>
</div>
<div id="generate-trelliscope" class="section level1">
<h1>Generate Trelliscope</h1>
<p>Now we’re ready. The call to <code>trelliscope()</code> takes the dataset and then a bunch of other arguments like a title and subtitle and the default state for the number of rows and columns of panels and the default data to show on the panel under the visualisation.</p>
<pre class="r"><code>trelliscope(
  prepared_goat,
  name = &quot;The Mountain Goats discography&quot;,
  desc = &quot;Explore the Mountain Goats backcatalogue and filter by Spotify metrics like danceability and acousticness&quot;,
  nrow = 2, ncol = 5,  # arrangement of panels
  state = list(labels = c(&quot;Track&quot;, &quot;Album&quot;, &quot;Track #&quot;, &quot;Year&quot;, &quot;Energy&quot;))  # display on panels
)</code></pre>
<p>I’ve embedded here the output, but <a href="https://www.rostrum.blog/output/goat_scope/">you can click here to open full screen</a>.</p>
<iframe src="https://www.rostrum.blog/output/goat_scope/" width="672" height="400px">
</iframe>
<p>Explore the data by altering the defaults in the grid, labels, filter and sort buttons in the left-hand navigation panel. Cycle through the panels with the arrows in the upper right.</p>
</div>
<div id="bonus-content" class="section level1">
<h1>Bonus content!</h1>
<div id="energy" class="section level2">
<h2>Energy</h2>
<p>By default, the panels in this trelliscope are ordered by the ‘energy’ of a track; most energetic first. The top track for energy is one of my favourites: ‘Choked Out’ from ‘Beat the Champ’. Here’s a Spotify snippet.</p>
<iframe src="https://open.spotify.com/embed/track/6VAOhkoZypZtGFgrnIGr48" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media">
</iframe>
</div>
<div id="host-your-trelliscope" class="section level2">
<h2>Host your trelliscope</h2>
<p>Use the argument <code>path = "/tmp/goat-scope"</code> in the <code>trelliscope()</code> functino to save the files for your trelliscope to the temporary folder. You can then host the folder’s contents somewhere. I put mine in the <code>static/</code> directory of this site’s structure so it’s hosted on its own page at <a href="https://www.rostrum.blog/output/goat_scope/" class="uri">https://www.rostrum.blog/output/goat_scope/</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>I also once explored the use of <a href="">Trelliscope for UK education data</a> and have been meaning to write about it ever since.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
