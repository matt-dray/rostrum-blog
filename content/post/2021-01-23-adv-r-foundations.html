---
title: 'Advanced R: anchovy pizza'
author: 'Matt Dray'
date: '2021-01-23'
slug: adv-r-names
categories:
  - code
tags:
  - advanced-r
  - book
  - learning
  - pizza
  - r
draft: yes
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div class="figure">
<p><img src="/post/2021-01-23-adv-r-foundations_files/pizza.gif" alt="Bird's-eye view of Five large margherita pizzas on a table before and after consumption" width="75%"/></p>
</div>
<div id="tldr" class="section level1">
<h1>tl;dr</h1>
<p>I bought <a href="http://hadley.nz/">Hadley Wickham</a>â€™s <a href="https://adv-r.hadley.nz/">Advanced R</a> book<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> to help me better understand Râ€™s quirks. Can names and values (chapter 2) be explained with a contrived pizzeria analogy?<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
</div>
<div id="binding-basics" class="section level1">
<h1>Binding basics</h1>
<p>Welcome to the pizzeria. Our specialty is <em>pizza alla napoletana</em>, which is topped with mozzarella, tomatoes and freshly caught anchovies.</p>
<pre class="r"><code># Create a character-vector object
napoletana &lt;- napoletana &lt;- c(&quot;ğŸ§€&quot;, &quot;ğŸ…&quot;, &quot;ğŸŸ&quot;)</code></pre>
<p>The English version of the menu calls it â€˜Neapolitan pizzaâ€™, but itâ€™s exactly the same thing.</p>
<pre class="r"><code># Copy the object
neapolitan &lt;- napoletana</code></pre>
<p>Unique topping lists are stored in our recipe books with a special reference code.</p>
<pre class="r"><code># The {lobstr} package for understaning object structures
library(lobstr)

# Get the specific object &#39;address&#39; in your computer&#39;s memory
# Both names point to the same object
obj_addr(napoletana)</code></pre>
<pre><code>## [1] &quot;0x7f983b72f698&quot;</code></pre>
<pre class="r"><code>obj_addr(neapolitan)</code></pre>
<pre><code>## [1] &quot;0x7f983b72f698&quot;</code></pre>
<p>The pizzaiolos donâ€™t care: <em>napoletana</em>, Neapolitan; different name, same pizza.</p>
<div class="tip">
<p>ğŸ“– â€œThe object, or value, doesnâ€™t have a name; itâ€™s actually <em>the name that has a value</em>â€ (page 19)</p>
</div>
</div>
<div id="copy-on-modify" class="section level1">
<h1>Copy on modify</h1>
<p>We recently added <em>pizza pugliese</em> to the menu. We just copied the Neapolitan recipe and swapped the anchovies for onions.</p>
<pre class="r"><code># Copy the object, update one value
pugliese &lt;- napoletana
pugliese[[3]] &lt;- &quot;ğŸ§…&quot;</code></pre>
<p>The two pizzas had the same special recipe code until the anchovy-onion switcheroo.</p>
<p>We needed a whole new code after the change.</p>
<pre class="r"><code># Now the names point to different objects
# We modified the copy, so it becomes a new object in memory
obj_addr(napoletana)</code></pre>
<pre><code>## [1] &quot;0x7f983b72f698&quot;</code></pre>
<pre class="r"><code>obj_addr(pugliese)</code></pre>
<pre><code>## [1] &quot;0x7f98397f1998&quot;</code></pre>
<div class="tip">
<p>ğŸ“– â€œThis behaviour is called <em>copy-on-modify</em>â€ (page 22)</p>
</div>
<p>Hereâ€™s the entries in the recipe book for these pizzas.</p>
<pre class="r"><code>knitr::kable(
  tibble::tribble(
    ~Code, ~Name, ~`Additional topping`, 
    obj_addr(napoletana), &quot;Pizza alla napoletana&quot;, napoletana[3],
    obj_addr(neapolitan), &quot;Neapolitan pizza&quot;, neapolitan[3], 
    obj_addr(pugliese), &quot;Pizza pugliese&quot;, pugliese[3]
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Code</th>
<th align="left">Name</th>
<th align="left">Additional topping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0x7f983b72f698</td>
<td align="left">Pizza alla napoletana</td>
<td align="left">ğŸŸ</td>
</tr>
<tr class="even">
<td align="left">0x7f983b72f698</td>
<td align="left">Neapolitan pizza</td>
<td align="left">ğŸŸ</td>
</tr>
<tr class="odd">
<td align="left">0x7f98397f1998</td>
<td align="left">Pizza pugliese</td>
<td align="left">ğŸ§…</td>
</tr>
</tbody>
</table>
<p>Two names refer to the anchovy pizza and one name points to the onion pizza.</p>
</div>
<div id="lists" class="section level1">
<h1>Lists</h1>
<p>Our knowledge management system was a bit inefficient: the mozzarella and tomato toppings exist twice in our recipe book, once for each pizza.</p>
<p>So we updated our recipe system to store each topping separately with their own special reference codes too.</p>
<p>Again, we wrote down the <em>napoletana</em> toppings, copied them and switched the anchovies for onions.</p>
<pre class="r"><code># Store toppings as list elements instead of a vector
# Copy the list, modify an element
napoletana &lt;- list(&quot;ğŸ§€&quot;, &quot;ğŸ…&quot;, &quot;ğŸŸ&quot;)
pugliese &lt;- napoletana
pugliese[[3]] &lt;- &quot;ğŸ§…&quot;</code></pre>
<p>The two pizzas again have different codes in our recipe book. Not a surprise.</p>
<p>But now the pizzas both point to the same codes for mozzarella and tomato. Much more efficient (especially if we expand our menu to more than two pizzas<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>).</p>
<pre class="r"><code># Compare addresses in memory for the lists
# Only the modified element was updated; not the whole list
ref(
  napoletana,  # the original
  pugliese     # the modified copy
)</code></pre>
<pre><code>## â–ˆ [1:0x7f983f402928] &lt;list&gt; 
## â”œâ”€[2:0x7f983d79f598] &lt;chr&gt; 
## â”œâ”€[3:0x7f983d79f528] &lt;chr&gt; 
## â””â”€[4:0x7f983d79f4b8] &lt;chr&gt; 
##  
## â–ˆ [5:0x7f983f408098] &lt;list&gt; 
## â”œâ”€[2:0x7f983d79f598] 
## â”œâ”€[3:0x7f983d79f528] 
## â””â”€[6:0x7f983d79f3a0] &lt;chr&gt;</code></pre>
<p>Each recipe points to a different place for its unique additional topping, of course.</p>
<div class="tip">
<p>ğŸ“–
â€œThis list is more complex [than a vector] because instead of storing the values itself, it stores <em>references to them</em>â€ (page 25)</p>
</div>
</div>
<div id="data-frames" class="section level1">
<h1>Data frames</h1>
<p>How do we manage orders? Wait staff put each order in a column, with a row for each topping.</p>
<p>Letâ€™s say a couple orders a <em>napoletana</em> and a <em>pugliese</em>.</p>
<pre class="r"><code># Create a data.frame, which is a list of vectors
order &lt;- data.frame(
  napoletana = c(&quot;ğŸ§€&quot;, &quot;ğŸ…&quot;, &quot;ğŸŸ&quot;),
  pugliese = c(&quot;ğŸ§€&quot;, &quot;ğŸ…&quot;, &quot;ğŸ§…&quot;)
)

knitr::kable(order)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">napoletana</th>
<th align="left">pugliese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ğŸ§€</td>
<td align="left">ğŸ§€</td>
</tr>
<tr class="even">
<td align="left">ğŸ…</td>
<td align="left">ğŸ…</td>
</tr>
<tr class="odd">
<td align="left">ğŸŸ</td>
<td align="left">ğŸ§…</td>
</tr>
</tbody>
</table>
<p>The customer who ordered the <em>napoletana</em> is hungry â€” more anchovies!</p>
<pre class="r"><code># Copy the object and modify one row in one column
order_update &lt;- order
order_update[3, 1] &lt;- &quot;ğŸŸğŸŸ&quot; 
knitr::kable(order_update)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">napoletana</th>
<th align="left">pugliese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ğŸ§€</td>
<td align="left">ğŸ§€</td>
</tr>
<tr class="even">
<td align="left">ğŸ…</td>
<td align="left">ğŸ…</td>
</tr>
<tr class="odd">
<td align="left">ğŸŸğŸŸ</td>
<td align="left">ğŸ§…</td>
</tr>
</tbody>
</table>
<p>We use a code reference system for our orders too.</p>
<p>The <em>napoletana</em> was modified after it was copied, so the code for that pizza was updated. The <em>pugliese</em> didnâ€™t change, so its code is maintained.</p>
<p>since one of the pizza orders was changed, our reference code for the entire order was changed too</p>
<pre class="r"><code># Compare addresses in memory for the data.frames
# The whole column (a vector, remember) was replaced
ref(
  order,        # the original
  order_update  # the modified copy
)</code></pre>
<pre><code>## â–ˆ [1:0x7f983f4396c8] &lt;df[,2]&gt; 
## â”œâ”€napoletana = [2:0x7f983f436c48] &lt;chr&gt; 
## â””â”€pugliese = [3:0x7f983f436bf8] &lt;chr&gt; 
##  
## â–ˆ [4:0x7f983fcc8248] &lt;df[,2]&gt; 
## â”œâ”€napoletana = [5:0x7f983fcca788] &lt;chr&gt; 
## â””â”€pugliese = [3:0x7f983f436bf8]</code></pre>
<div class="tip">
<p>ğŸ“–
â€œIf you modify a column, only that column needs to be modifiedâ€ (page 26)</p>
</div>
<p>At this point, both customers also decide to order extra mozzarella. Of course you would!</p>
<p>The waiter again copies the order and changes the cheese row for both pizzas.</p>
<pre class="r"><code># Copy the data.frame object, modify a row
order_final &lt;- order_update
order_final[1, 1:2] &lt;- &quot;ğŸ§€ğŸ§€&quot;
knitr::kable(order_final)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">napoletana</th>
<th align="left">pugliese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ğŸ§€ğŸ§€</td>
<td align="left">ğŸ§€ğŸ§€</td>
</tr>
<tr class="even">
<td align="left">ğŸ…</td>
<td align="left">ğŸ…</td>
</tr>
<tr class="odd">
<td align="left">ğŸŸğŸŸ</td>
<td align="left">ğŸ§…</td>
</tr>
</tbody>
</table>
<p>Altering the cheese row means both pizza columns are copied and given new codes. Of course, the order gets a whole new code of its own because the toppings were changed.</p>
<pre class="r"><code># Compare addresses in memory for the data.frames
# All columns were replaced (modifying a row modifies all columns)
ref(
  order,       # the original
  order_final  # the modified copy
)</code></pre>
<pre><code>## â–ˆ [1:0x7f983f4396c8] &lt;df[,2]&gt; 
## â”œâ”€napoletana = [2:0x7f983f436c48] &lt;chr&gt; 
## â””â”€pugliese = [3:0x7f983f436bf8] &lt;chr&gt; 
##  
## â–ˆ [4:0x7f983f4b7048] &lt;df[,2]&gt; 
## â”œâ”€napoletana = [5:0x7f983f4baeb8] &lt;chr&gt; 
## â””â”€pugliese = [6:0x7f983f4bae68] &lt;chr&gt;</code></pre>
<div class="tip">
<p>ğŸ“– â€œIf you modify a row, every column is modified, which means every column must be copiedâ€ (page 27)</p>
</div>
<p><em>Buon appetito</em>.</p>
<hr />
<details>
<summary>
Session info
</summary>
<pre><code>## â”€ Session info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
##  setting  value                       
##  version  R version 4.0.2 (2020-06-22)
##  os       macOS  10.16                
##  system   x86_64, darwin17.0          
##  ui       X11                         
##  language (EN)                        
##  collate  en_GB.UTF-8                 
##  ctype    en_GB.UTF-8                 
##  tz       Europe/London               
##  date     2021-01-26                  
## 
## â”€ Packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
##  package     * version    date       lib source                            
##  assertthat    0.2.1      2019-03-21 [1] CRAN (R 4.0.0)                    
##  blogdown      1.0.5      2021-01-17 [1] Github (rstudio/blogdown@fa67a87) 
##  bookdown      0.21       2020-10-13 [1] CRAN (R 4.0.2)                    
##  cli           2.2.0      2020-11-20 [1] CRAN (R 4.0.2)                    
##  crayon        1.3.4      2017-09-16 [1] CRAN (R 4.0.0)                    
##  digest        0.6.27     2020-10-24 [1] CRAN (R 4.0.2)                    
##  ellipsis      0.3.1      2020-05-15 [1] CRAN (R 4.0.0)                    
##  emo           0.0.0.9000 2020-05-24 [1] Github (hadley/emo@3f03b11)       
##  evaluate      0.14       2019-05-28 [1] CRAN (R 4.0.0)                    
##  fansi         0.4.1      2020-01-08 [1] CRAN (R 4.0.0)                    
##  generics      0.1.0      2020-10-31 [1] CRAN (R 4.0.2)                    
##  glue          1.4.2      2020-08-27 [1] CRAN (R 4.0.2)                    
##  highr         0.8        2019-03-20 [1] CRAN (R 4.0.0)                    
##  htmltools     0.5.1.9000 2021-01-17 [1] Github (rstudio/htmltools@11cfbf3)
##  knitr         1.30       2020-09-22 [1] CRAN (R 4.0.2)                    
##  lifecycle     0.2.0      2020-03-06 [1] CRAN (R 4.0.0)                    
##  lobstr      * 1.1.1      2019-07-02 [1] CRAN (R 4.0.2)                    
##  lubridate     1.7.9.2    2020-11-13 [1] CRAN (R 4.0.2)                    
##  magrittr      2.0.1      2020-11-17 [1] CRAN (R 4.0.2)                    
##  pillar        1.4.7      2020-11-20 [1] CRAN (R 4.0.2)                    
##  pkgconfig     2.0.3      2019-09-22 [1] CRAN (R 4.0.0)                    
##  purrr         0.3.4      2020-04-17 [1] CRAN (R 4.0.0)                    
##  Rcpp          1.0.6      2021-01-15 [1] CRAN (R 4.0.2)                    
##  rlang         0.4.10     2020-12-30 [1] CRAN (R 4.0.2)                    
##  rmarkdown     2.6        2020-12-14 [1] CRAN (R 4.0.2)                    
##  rstudioapi    0.13       2020-11-12 [1] CRAN (R 4.0.2)                    
##  sessioninfo   1.1.1      2018-11-05 [1] CRAN (R 4.0.0)                    
##  stringi       1.5.3      2020-09-09 [1] CRAN (R 4.0.2)                    
##  stringr       1.4.0      2019-02-10 [1] CRAN (R 4.0.0)                    
##  tibble        3.0.4      2020-10-12 [1] CRAN (R 4.0.2)                    
##  vctrs         0.3.6      2020-12-17 [1] CRAN (R 4.0.2)                    
##  withr         2.4.0      2021-01-16 [1] CRAN (R 4.0.2)                    
##  xfun          0.20       2021-01-06 [1] CRAN (R 4.0.2)                    
##  yaml          2.2.1      2020-02-01 [1] CRAN (R 4.0.0)                    
## 
## [1] /Library/Frameworks/R.framework/Versions/4.0/Resources/library</code></pre>
</details>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>You can <a href="https://www.amazon.com/gp/product/0815384572/ref=as_li_tl?ie=UTF8&amp;tag=hadlwick-20&amp;camp=1789&amp;creative=9325&amp;linkCode=as2&amp;creativeASIN=0815384572&amp;linkId=9f8b9df5da858c12a5e9905aea66bf08">buy the book</a>, or <a href="https://adv-r.hadley.nz/">view it for free online</a>.<a href="#fnref1" class="footnote-back">â†©ï¸</a></p></li>
<li id="fn2"><p>Initially I went with a metaphor about how a Quarter Pounder with Cheese is called a Royale with Cheese in Paris (or indeed, a Krusty Burger with Cheese is called a Quarter Pounder with Cheese at McDonaldâ€™s), but the pop culture reference was better than the actual utility of the metaphor.<a href="#fnref2" class="footnote-back">â†©ï¸</a></p></li>
<li id="fn3"><p>Of course, if youâ€™re really serious about pizza, you only offer marianara and margherita <a href="http://www.damichele.net/le-nostre-pizze/">as per Lâ€™antica Pizzeria Da Michele</a>, which is where I took the photos that are in this post.<a href="#fnref3" class="footnote-back">â†©ï¸</a></p></li>
</ol>
</div>
