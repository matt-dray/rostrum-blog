---
title: 'Advanced R: anchovy pizza'
author: 'Matt Dray'
date: '2021-01-23'
slug: adv-r-names
categories:
  - code
tags:
  - advanced-r
  - book
  - learning
  - pizza
  - r
draft: yes
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div class="figure">
<p><img src="/post/2021-01-23-adv-r-foundations_files/pizza.gif" alt="Bird's-eye view of five large margherita pizzas on a table before and after consumption" width="75%"/></p>
</div>
<div id="tldr" class="section level1">
<h1>tl;dr</h1>
<p>I bought <a href="http://hadley.nz/">Hadley Wickham</a>’s <a href="https://adv-r.hadley.nz/">Advanced R</a> book<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> to help me better understand R’s quirks. Can names and values (chapter 2) be explained with a contrived pizzeria analogy?<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
</div>
<div id="a-pizza-by-any-other-name" class="section level1">
<h1>A pizza by any other name</h1>
<p>Welcome to the pizzeria. Our specialty is <em>pizza alla napoletana</em> topped with mozzarella, tomatoes and anchovies.</p>
<pre class="r"><code># Create a character-vector object
napoletana &lt;- c(&quot;🧀&quot;, &quot;🍅&quot;, &quot;🐟&quot;)</code></pre>
<p>The English version of the menu calls it ‘Neapolitan’ pizza.</p>
<pre class="r"><code># Copy the character-vector object
neapolitan &lt;- napoletana
all(neapolitan == napoletana)  # they&#39;re equal</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>We store our unique pizza topping sets in a recipe book. If you look up ‘napoletana’ and ‘Neapolitan’ in the index of the book, you’ll see they point to the same recipe.</p>
<pre class="r"><code># The {lobstr} package helps understand object structure
library(lobstr)  # after install.packages(&quot;lobstr&quot;)

# Get the specific object &#39;address&#39; in your computer&#39;s memory
# Both names point to the same object
obj_addr(napoletana)</code></pre>
<pre><code>## [1] &quot;0x7fbdd75bfd28&quot;</code></pre>
<pre class="r"><code>obj_addr(neapolitan)</code></pre>
<pre><code>## [1] &quot;0x7fbdd75bfd28&quot;</code></pre>
<p>The pizzaiolos don’t care: different names, same pizza. Their ‘recipe codes’ are the same.</p>
<div class="tip">
<p>📖 “The object, or value, doesn’t have a name; it’s actually <em>the name that has a value</em>” (page 19)</p>
</div>
</div>
<div id="copying-a-recipe-modifying-it" class="section level1">
<h1>Copying a recipe, modifying it</h1>
<p>We recently added <em>pizza pugliese</em> to the menu. The napoletana was copied and then modified to produce the pugliese, which has onions instead of anchovies.</p>
<pre class="r"><code>pugliese &lt;- napoletana       # copy the object
all(pugliese == napoletana)  # the objects are the same</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>pugliese[[3]] &lt;- &quot;🧅&quot;   # modify the third element
pugliese == napoletana  # they&#39;re no longer the same</code></pre>
<pre><code>## [1]  TRUE  TRUE FALSE</code></pre>
<p>When we look up these names in the index of our recipe book, we see that they point to different places.</p>
<pre class="r"><code># Now the names point to different objects
# We modified the copy, so it becomes a new object in memory
obj_addr(napoletana)</code></pre>
<pre><code>## [1] &quot;0x7fbdd75bfd28&quot;</code></pre>
<pre class="r"><code>obj_addr(pugliese)</code></pre>
<pre><code>## [1] &quot;0x7fbddaf8c768&quot;</code></pre>
<div class="tip">
<p>📖 “This behaviour is called <em>copy-on-modify</em>” (page 22)</p>
</div>
<p>Here’s how our menu looks.</p>
<pre class="r"><code>apulian &lt;- pugliese  # copy pugliese object, English name

# A comparison of the pizza object structures
knitr::kable(
  tibble::tribble(
    ~Language, ~Name, ~`Toppings`, ~`Recipe code`, 
    &quot;ITA&quot;, &quot;Pizza alla napoletana&quot;, napoletana, obj_addr(napoletana),
    &quot;ENG&quot;, &quot;Neapolitan pizza&quot;, neapolitan, obj_addr(neapolitan),
    &quot;ITA&quot;, &quot;Pizza pugliese&quot;, pugliese, obj_addr(pugliese),
    &quot;ENG&quot;, &quot;Apulian pizza&quot;, apulian, obj_addr(apulian)
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Language</th>
<th align="left">Name</th>
<th align="left">Toppings</th>
<th align="left">Recipe code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ITA</td>
<td align="left">Pizza alla napoletana</td>
<td align="left">🧀, 🍅, 🐟</td>
<td align="left">0x7fbdd75bfd28</td>
</tr>
<tr class="even">
<td align="left">ENG</td>
<td align="left">Neapolitan pizza</td>
<td align="left">🧀, 🍅, 🐟</td>
<td align="left">0x7fbdd75bfd28</td>
</tr>
<tr class="odd">
<td align="left">ITA</td>
<td align="left">Pizza pugliese</td>
<td align="left">🧀, 🍅, 🧅</td>
<td align="left">0x7fbddaf8c768</td>
</tr>
<tr class="even">
<td align="left">ENG</td>
<td align="left">Apulian pizza</td>
<td align="left">🧀, 🍅, 🧅</td>
<td align="left">0x7fbddaf8c768</td>
</tr>
</tbody>
</table>
<p>Pizza alla napoletana and its copy, Neapolitan pizza, point to the same recipe code.</p>
<p>Pizza pugliese was a copy of pizza alla napoletana, but it now points to a different recipe code. Why? An element was changed, anchovies to onions, so a new recipe code was required.</p>
<p>Apulian pizza is a copy of the pizza pugliese recipe, so they point to the same unique topping set.</p>
</div>
<div id="efficient-recipe-management-with-lists" class="section level1">
<h1>Efficient recipe management with lists</h1>
<p>Our knowledge management system was, however, a bit inefficient: the mozzarella and tomato toppings existed twice in our recipe book, once for each pizza.</p>
<p>So we updated our recipe system to store each topping separately with their own special reference codes too.</p>
<p>Again, we wrote down the pizza napoletana toppings, copied them, then switched the anchovies for onions. Like in our old system, the two pizzas differ in their third element.</p>
<pre class="r"><code>napoletana &lt;- list(&quot;🧀&quot;, &quot;🍅&quot;, &quot;🐟&quot;)  # toppings as list elements
pugliese &lt;- napoletana  # make a copy
identical(pugliese, napoletana) # they&#39;re the same</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>pugliese[[3]] &lt;- &quot;🧅&quot;   # make a change
identical(pugliese, napoletana) # now they&#39;re different</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p>In the new system, each topping also has its own unique ingredient code. This means both pizza recipes point to the same ingredient codes for tomato and mozzarella.</p>
<pre class="r"><code># Compare addresses in memory for the lists
# Each &#39;block&#39; below is a list object (pizza)
# Each element is a character vector (topping)
ref(napoletana, pugliese)</code></pre>
<pre><code>## █ [1:0x7fbddd6b6d88] &lt;list&gt; 
## ├─[2:0x7fbddccd41b8] &lt;chr&gt; 
## ├─[3:0x7fbddccd4148] &lt;chr&gt; 
## └─[4:0x7fbddccd40d8] &lt;chr&gt; 
##  
## █ [5:0x7fbddd6bb198] &lt;list&gt; 
## ├─[2:0x7fbddccd41b8] 
## ├─[3:0x7fbddccd4148] 
## └─[6:0x7fbddccd3f88] &lt;chr&gt;</code></pre>
<p>So our pizza names point to pizza recipes that themselves point out to toppings.</p>
<div class="tip">
<p>📖
“This list is more complex [than a vector] because instead of storing the values itself, it stores <em>references to them</em>” (page 25)</p>
</div>
<p>This means we can be more efficient in storing our pizza recipes, particularly if we expand our menu to more than two pizzas.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
</div>
<div id="customer-orders-in-data-frames" class="section level1">
<h1>Customer orders in data frames</h1>
<p>How do we manage orders? Wait staff write down each order in a column, with a row for each topping.</p>
<p>Let’s say a couple orders a pizza napoletana and a pizza pugliese.</p>
<pre class="r"><code># Create a data.frame, which is a list of vectors
order &lt;- data.frame(
  napoletana = c(&quot;🧀&quot;, &quot;🍅&quot;, &quot;🐟&quot;),
  pugliese = c(&quot;🧀&quot;, &quot;🍅&quot;, &quot;🧅&quot;)
)

knitr::kable(order)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">napoletana</th>
<th align="left">pugliese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">🧀</td>
<td align="left">🧀</td>
</tr>
<tr class="even">
<td align="left">🍅</td>
<td align="left">🍅</td>
</tr>
<tr class="odd">
<td align="left">🐟</td>
<td align="left">🧅</td>
</tr>
</tbody>
</table>
<div class="tip">
<p>📖 “Data frames are lists of vectors” (page 26)</p>
</div>
<p>But wait: the customer who ordered the napoletana is hungry for more anchovies!</p>
<pre class="r"><code>order_update &lt;- order  # copy the data.frame object
order_update[3, 1] &lt;- &quot;🐟🐟&quot;  # modify the new object
knitr::kable(order_update)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">napoletana</th>
<th align="left">pugliese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">🧀</td>
<td align="left">🧀</td>
</tr>
<tr class="even">
<td align="left">🍅</td>
<td align="left">🍅</td>
</tr>
<tr class="odd">
<td align="left">🐟🐟</td>
<td align="left">🧅</td>
</tr>
</tbody>
</table>
<p>We use a code reference system for our orders too and it works just like our old recipe system.</p>
<p>The napoletana was modified after it was copied, so the recipe code for that pizza was updated. The pugliese didn’t change, so its code was maintained.</p>
<p>Since one of the pizza orders was changed, our reference code for the entire order was changed too.</p>
<pre class="r"><code># Compare the data.frame structures
# Modified column gets new code, object gets new code
# Second column unchanged, code stays the same
ref(order, order_update)</code></pre>
<pre><code>## █ [1:0x7fbdd95f1f88] &lt;df[,2]&gt; 
## ├─napoletana = [2:0x7fbdd95c1628] &lt;chr&gt; 
## └─pugliese = [3:0x7fbdd95c15d8] &lt;chr&gt; 
##  
## █ [4:0x7fbdd97572c8] &lt;df[,2]&gt; 
## ├─napoletana = [5:0x7fbdd9764078] &lt;chr&gt; 
## └─pugliese = [3:0x7fbdd95c15d8]</code></pre>
<div class="tip">
<p>📖
“If you modify a column, only that column needs to be modified” (page 26)</p>
</div>
<p>The buffala mozzarella is especially bountiful this year; the waiter suggests both patrons add some more.</p>
<p>The order is copied once more and the waiter modifies the ‘cheese row’ for both pizzas.</p>
<pre class="r"><code>order_final &lt;- order_update  # copy the object
order_final[1, 1:2] &lt;- &quot;🧀🧀&quot;  # modify row one of both columns
knitr::kable(order_final)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">napoletana</th>
<th align="left">pugliese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">🧀🧀</td>
<td align="left">🧀🧀</td>
</tr>
<tr class="even">
<td align="left">🍅</td>
<td align="left">🍅</td>
</tr>
<tr class="odd">
<td align="left">🐟🐟</td>
<td align="left">🧅</td>
</tr>
</tbody>
</table>
<p>Altering the cheese row means both pizza columns are copied and given new codes. Of course, the order gets a whole new code of its own because the toppings were changed.</p>
<pre class="r"><code># Compare data.frame structures again
# All columns modified, so copies made
# data.frame and column memory locations all differ
ref(order, order_final)</code></pre>
<pre><code>## █ [1:0x7fbdd95f1f88] &lt;df[,2]&gt; 
## ├─napoletana = [2:0x7fbdd95c1628] &lt;chr&gt; 
## └─pugliese = [3:0x7fbdd95c15d8] &lt;chr&gt; 
##  
## █ [4:0x7fbdda1d9a48] &lt;df[,2]&gt; 
## ├─napoletana = [5:0x7fbdd950ff88] &lt;chr&gt; 
## └─pugliese = [6:0x7fbdd950ff38] &lt;chr&gt;</code></pre>
<div class="tip">
<p>📖 “If you modify a row, every column is modified, which means every column must be copied” (page 27)</p>
</div>
<p><em>Buon appetito</em>.</p>
</div>
<div id="il-conto" class="section level1">
<h1>Il conto</h1>
<p>So the analogy is too contrived.</p>
<hr />
<details>
<summary>
Session info
</summary>
<pre><code>## ─ Session info ───────────────────────────────────────────────────────────────
##  setting  value                       
##  version  R version 4.0.2 (2020-06-22)
##  os       macOS  10.16                
##  system   x86_64, darwin17.0          
##  ui       X11                         
##  language (EN)                        
##  collate  en_GB.UTF-8                 
##  ctype    en_GB.UTF-8                 
##  tz       Europe/London               
##  date     2021-01-28                  
## 
## ─ Packages ───────────────────────────────────────────────────────────────────
##  package     * version    date       lib source                            
##  assertthat    0.2.1      2019-03-21 [1] CRAN (R 4.0.0)                    
##  blogdown      1.0.5      2021-01-17 [1] Github (rstudio/blogdown@fa67a87) 
##  bookdown      0.21       2020-10-13 [1] CRAN (R 4.0.2)                    
##  cli           2.2.0      2020-11-20 [1] CRAN (R 4.0.2)                    
##  crayon        1.3.4      2017-09-16 [1] CRAN (R 4.0.0)                    
##  digest        0.6.27     2020-10-24 [1] CRAN (R 4.0.2)                    
##  ellipsis      0.3.1      2020-05-15 [1] CRAN (R 4.0.0)                    
##  emo           0.0.0.9000 2020-05-24 [1] Github (hadley/emo@3f03b11)       
##  evaluate      0.14       2019-05-28 [1] CRAN (R 4.0.0)                    
##  fansi         0.4.1      2020-01-08 [1] CRAN (R 4.0.0)                    
##  generics      0.1.0      2020-10-31 [1] CRAN (R 4.0.2)                    
##  glue          1.4.2      2020-08-27 [1] CRAN (R 4.0.2)                    
##  highr         0.8        2019-03-20 [1] CRAN (R 4.0.0)                    
##  htmltools     0.5.1.9000 2021-01-17 [1] Github (rstudio/htmltools@11cfbf3)
##  knitr         1.30       2020-09-22 [1] CRAN (R 4.0.2)                    
##  lifecycle     0.2.0      2020-03-06 [1] CRAN (R 4.0.0)                    
##  lobstr      * 1.1.1      2019-07-02 [1] CRAN (R 4.0.2)                    
##  lubridate     1.7.9.2    2020-11-13 [1] CRAN (R 4.0.2)                    
##  magrittr      2.0.1      2020-11-17 [1] CRAN (R 4.0.2)                    
##  pillar        1.4.7      2020-11-20 [1] CRAN (R 4.0.2)                    
##  pkgconfig     2.0.3      2019-09-22 [1] CRAN (R 4.0.0)                    
##  purrr         0.3.4      2020-04-17 [1] CRAN (R 4.0.0)                    
##  Rcpp          1.0.6      2021-01-15 [1] CRAN (R 4.0.2)                    
##  rlang         0.4.10     2020-12-30 [1] CRAN (R 4.0.2)                    
##  rmarkdown     2.6        2020-12-14 [1] CRAN (R 4.0.2)                    
##  rstudioapi    0.13       2020-11-12 [1] CRAN (R 4.0.2)                    
##  sessioninfo   1.1.1      2018-11-05 [1] CRAN (R 4.0.0)                    
##  stringi       1.5.3      2020-09-09 [1] CRAN (R 4.0.2)                    
##  stringr       1.4.0      2019-02-10 [1] CRAN (R 4.0.0)                    
##  tibble        3.0.4      2020-10-12 [1] CRAN (R 4.0.2)                    
##  vctrs         0.3.6      2020-12-17 [1] CRAN (R 4.0.2)                    
##  withr         2.4.0      2021-01-16 [1] CRAN (R 4.0.2)                    
##  xfun          0.20       2021-01-06 [1] CRAN (R 4.0.2)                    
##  yaml          2.2.1      2020-02-01 [1] CRAN (R 4.0.0)                    
## 
## [1] /Library/Frameworks/R.framework/Versions/4.0/Resources/library</code></pre>
</details>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>You can <a href="https://www.amazon.com/gp/product/0815384572/ref=as_li_tl?ie=UTF8&amp;tag=hadlwick-20&amp;camp=1789&amp;creative=9325&amp;linkCode=as2&amp;creativeASIN=0815384572&amp;linkId=9f8b9df5da858c12a5e9905aea66bf08">buy the book</a>, or <a href="https://adv-r.hadley.nz/">view it for free online</a>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Initially I went with a metaphor about how a Quarter Pounder with Cheese is called a Royale with Cheese in Paris (or indeed, a Krusty Burger with Cheese is called a Quarter Pounder with Cheese at McDonald’s), but the pop culture reference was better than the actual utility of the metaphor.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Of course, if you’re really serious about pizza, you only offer marianara and margherita <a href="http://www.damichele.net/le-nostre-pizze/">as per L’antica Pizzeria Da Michele</a>, which is where I took the photos that are in this post.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
