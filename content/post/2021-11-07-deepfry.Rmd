---
title: "Deepfried memes with R"
author: Matt Dray
date: '2021-11-07'
slug: deepfry
categories:
  - code
  - tutorial
tags:
  - magick
  - meme
  - r
draft: yes
---


tl;dr

You can make memes in R with the {meme} package. You should be able to deep-fry them.

# Setup

Install and attach the packages we need.

At time of writing there is an issue with importing fonts via {extrafont} that [requires an earlier version of {Rttf2pt1} to be installed](https://stackoverflow.com/a/68642855).

```{r}
# install.packages(c("meme", "extrafont", "magick", "remotes"))
# remotes::install_version("Rttf2pt1", version = "1.3.8")
```

Now to import the fonts from your system.

```{r eval=FALSE}
meme::font_import()
```

# Meme

Make a meme.

```{r}
img_path <- "~/Desktop/rmeme.jpg"

meme_img <- meme::meme(
  img_path,
  upper = "top text",
  lower = "bottom text"
)

meme_img
```

There is a `meme_save()` function that's like `ggsave()`

```{r}
meme_out <- tempfile(fileext = ".jpg")
meme::meme_save(meme_img, file = meme_out)
```

# Fry

Function to read and manipulate image, then re-save as a horribly compressed jpeg. It outputs as a `magick-image` object that you can save with `magick::image_write()`.

```{r}
fry <- function(
  img_path,
  emoji_path = "/post/2021-11-07-deepfry_files/deepfry-emoji.jpg",
  depth = c("shallow", "deep")) {
  
  depth <- match.arg(depth)
  
  cat("Heating oil... ")
  
  if (depth == "shallow") {
    compress <- 8
  } 
  
  if (depth == "deep") {
    compress <- 1
  } 
  
  emoji <- magick::image_read(emoji_path) |> 
    magick::image_rotate(sample(-45:45, 1))
  
  gravities <-  c(
    paste0("north", c("east", "west")),
    paste0("south", c("east", "west")),
    "east", "west", "center"
  )
  
  emo_gravity <- sample(gravities, 1)
  
  img_in <- magick::image_read(img_path) |> 
    magick::image_scale("800") |> 
    magick::image_composite(emoji, gravity = emo_gravity) |> 
    magick::image_colorize(30, "orange") |>
    magick::image_modulate(80, 120, 90) |> 
    magick::image_contrast(sharpen = 100) |> 
    magick::image_noise()
  
  cat("dunking... ")
  path_out <- tempfile("meme", fileext = ".jpeg")
  magick::image_write(img_in, path_out, "jpeg", compress)
  
  cat("crisp.")
  magick::image_read(path_out)
  
}
```

S H A L L O W   F R Y .

```{r}
fry(meme_img)
```

D E E P   F R Y .

```{r}
fry(meme_img, depth = "deep")
```

---
<details><summary>Session info</summary>
```{r sessioninfo, echo=FALSE}
sessioninfo::session_info()
```
</details>
