---
title: 'Can {drake} RAP?'
author: Matt Dray
date: '2019-06-10'
slug: drake-lays-an-egg
categories:
  - R
tags:
  - reproducibility
  - drake
  - eggs
  - rap
  - reproducible analytical pipelines
  - make
  - make file
draft: yes
---



<div id="take-the-rap" class="section level1">
<h1>Take the RAP</h1>
<p><a href="https://ukgovdatascience.github.io/rap-website/">Reproducible Analytical Pipelines</a> (RAP) is an approach to generating <a href="https://www.gov.uk/search/research-and-statistics">the UK government’s official statistics</a> that improves reproducibility, minimises errors and speeds up production.</p>
<p>RAP does away with the tangled webs of spreadsheets, copy-pasting errors and infernal <code>publication_FINAL-v2_md-comments_FINAL.docx</code> file naming.</p>
<p>Instead, RAP encourages a script-based workflow that’s beefed up with stuff like version control, dependency management and automated testing.</p>
</div>
<div id="make-it" class="section level1">
<h1>Make it</h1>
<p>Projects can become complicated with multiple inputs, script files and outputs.</p>
<p>Sometimes you need to re-run your code if you’ve made a change. With a makefile, you only run the parts that have changed plus anything downstream that depends on those parts.</p>
<p>You can get around this with a <a href="https://en.wikipedia.org/wiki/Makefile">‘makefile’</a>. In short, you record each step of your analysis in a ‘recipe’ and the dependencies between each step are recorded.</p>
<p>Now you don’t have to re-run the entire analysis if a change is made. Only the things that need to be re-run will be re-run. This saves compute time and means you don’t have to remember any dependencies yourself.</p>
</div>
<div id="bake-a-drake-make-cake" class="section level1">
<h1>Bake a {drake} make cake</h1>
<p><a href="https://github.com/ropensci/drake">{drake}</a> is a package by <a href="https://wlandau.github.io/">Will Landau</a> that lets you create makefiles using R syntax. Drake == Dataframes in R for Make.</p>
<p>In brief, you prepare a ‘plan’ file that records all the functions to be run. Running the plan for the first time will run all the steps of the analysis. Nothing will happen if you try to run it a second time because everything is up to date. If you make a small change to your code and then re-run the plan, then only the parts of the code impacted by that change are re-run.</p>
<p>{drake} provides a helpful dependency network diagram so you can understand these relationships and what has changed following any modifications of the code.</p>
<p>There’s some helpful material out there for learning more about {drake}:</p>
<ul>
<li><a href="https://ropenscilabs.github.io/drake-manual/">User Manual</a></li>
<li><a href="https://ropensci.github.io/drake/">Documentation</a></li>
<li><a href="https://github.com/krlmlr/drake-sib-zurich/blob/master/cheat-sheet.pdf">Cheat sheet</a> by Kirill Müller</li>
<li><a href="https://aedobbyn.github.io/nyc-fires/index.html#1">Drake for workflow happiness</a> slides by <a href="https://dobb.ae/">Amanda Dobbyn</a></li>
</ul>
</div>
<div id="drake-it-to-make-it" class="section level1">
<h1>{drake} it to make it</h1>
<p>I’ve made a very simple {drake} demo for an imaginary RAP project.</p>
<ul>
<li><a href="https://github.com/matt-dray/drake-egg-rap">GitHub</a></li>
<li><a href="https://matt-dray.github.io/drake-egg-rap/">Example HTML output</a></li>
</ul>
<div id="eggsample" class="section level2">
<h2>Eggsample</h2>
<p>There is a <a href="https://www.gov.uk/government/statistics/egg-statistics">statistical publication that tracks UK egg production</a>. As far as I know, it’s not currently created using a RAP process. It’s a prime candidate though:</p>
<ul>
<li>the content has remained pretty consistent over time, so little manual change would be required to the report template</li>
<li>it’s produced quarterly, so total time savings could be high</li>
<li>it’s badged as <a href="https://www.statisticsauthority.gov.uk/osr/list-of-national-statistics/">National Statistics</a> and must therefore uphold certain quality standards</li>
<li>there was an error in calculating year-on-year change in May this year (click ‘+ show all updates’ on <a href="https://www.gov.uk/government/statistics/egg-statistics">the egg statistics page</a>, which is exactly the type of thing that RAP is designed to help reduce</li>
</ul>
<p>Here I’ll show how to recreate a small part of the publication using {drake}.</p>
</div>
<div id="folder-structure" class="section level2">
<h2>Folder structure</h2>
</div>
<div id="a-very-cunning-plan" class="section level2">
<h2>A very cunning plan</h2>
</div>
</div>
