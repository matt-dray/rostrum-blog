---
title: 'Packages that Sparked Joy in 2019'
author: Matt Dray
date: '2019-12-27'
slug: pkgs-2019
categories:
  - code
tags:
  - arsenal
  - blogdown
  - drake
  - govdown
  - polite
  - purrr
  - r
  - usethis
  - xaringan
draft: no
---



<div class="figure">
<img src="https://media.giphy.com/media/4ZkiXE2yGFCEA3Sm6V/giphy.gif" alt="Marie Kondo putting her hands together and bowing." width=300/>
<p class="caption">
Marie Kondo (<a href="https://giphy.com/gifs/netflix-konmari-mariekondo-tidyingup-4ZkiXE2yGFCEA3Sm6V/links" target="_blank">Netflix via Giphy</a>)
</p>
</div>
<div id="thank-you-package-makers" class="section level1">
<h1>Thank you package-makers</h1>
<p>I’ve used a lot of packages in 2019 and many have brought great joy to my R experience. Thank you to everyone who has created, maintained or contributed to a package this year.</p>
<p>Some particular packages of note for me have been:</p>
<ul>
<li>🤖 <a href="#usethis">{usethis}</a> by Hadley Wickham and Jenny Bryan</li>
<li>🦆 <a href="#drake">{drake}</a> by Will Landau</li>
<li>🐈 <a href="#purrr">{purrr}</a> by Lionel Henry and Hadley Wickham</li>
</ul>
<p>And some honourable mentions are:</p>
<ul>
<li>📝 <a href="#blogdown">{blogdown}</a> by Yihui Xie</li>
<li>⚔️ <a href="#xaringan">{xaringan}</a> by Yihui Xie</li>
<li>🙇 <a href="#polite">{polite}</a> by Dmytro Perepolkin</li>
<li>↔️ <a href="#arsenal">{arsenal}</a> by Ethan Heinzen, Jason Sinnwell, Elizabeth Atkinson, Tina Gunderson and Gregory Dougherty</li>
</ul>
<p>Click the package name to jump to that section.</p>
</div>
<div id="packages-of-note" class="section level1">
<h1>Packages of note</h1>
<div id="usethis" class="section level2">
<h2>{usethis}</h2>
<p>The format and content of R packages is objectively odd. What files are necessary? What structure should it have? <a href="https://usethis.r-lib.org/" target="_blank">The {usethis} package</a> from <a href="https://rstudio.com/" target="_blank">RStudio</a>’s <a href="http://hadley.nz/" target="_blank">Hadley Wickham</a> and <a href="https://jennybryan.org/" target="_blank">Jenny Bryan</a> makes it far easier for newcomers and experienced useRs alike.</p>
<p>In fact, you can make a minimal package in two lines:</p>
<ol style="list-style-type: decimal">
<li><code>create_package()</code> to create the necessary package structure</li>
<li><code>use_r()</code> to create in the right place an R script for your functions</li>
</ol>
<p>But there’s way more functions to help you set up your package. To name a few more that I use regularly:</p>
<ul>
<li><code>use_vignette()</code> and <code>use_readme_md()</code> for more documentation</li>
<li><code>use_testthat()</code> and <code>use_test()</code> for setting up tests</li>
<li><code>use_package()</code> to add packages to the <code>Imports</code> section of the <code>DESCRIPTION</code> file</li>
<li><code>use_data()</code> and <code>use_data_raw()</code> to add data sets to the package and the code used to create them</li>
<li><code>use_*_license()</code> to add a license</li>
</ul>
<p>There are also other flavours of function like <code>git_*()</code> and <code>pr_*()</code> to work with version control and <code>proj_*()</code> for working with RStudio Projects.</p>
<p>I focused this year on making different types of package. {usethis} made it much easier to develop:</p>
<ul>
<li><a href="https://www.rostrum.blog/2019/12/08/altcheckr/" target="_blank">{altcheckr}</a> to read and assess <a href="https://www.w3.org/WAI/tutorials/images/" target="_blank">image alt text from web pages</a></li>
<li><a href="https://www.rostrum.blog/2019/12/23/oystr/" target="_blank">{oystr}</a> to handle London travel-history data from an <a href="https://oyster.tfl.gov.uk/oyster/entry.do" target="_blank">Oyster card</a></li>
<li><a href="https://www.rostrum.blog/2019/05/24/xaringan-template/" target="_blank">{gdstheme}</a> to use a <a href="https://slides.yihui.org/xaringan/" target="_blank">{xaringan}</a> presentation theme and template</li>
<li><a href="https://www.rostrum.blog/2019/10/22/blogsnip/" target="_blank">{blogsnip}</a> to insert blog-related code snippets via an <a href="https://rstudio.github.io/rstudioaddins/" target="_blank">RStudio addin</a> (there’s even a <code>use_addin()</code> function to create the all-important <code>inst/rstudio/addins.dcf</code> file)</li>
</ul>
<p>For more package-development info, I recommend <a href="https://www.hvitfeldt.me/blog/usethis-workflow-for-package-development/" target="_blank">Emil Hvitfeldt’s {usethis} workflow</a>, as well as <a href="https://kbroman.org/pkg_primer/" target="_blank">Karl Broman’s R Package Primer</a> and <a href="http://r-pkgs.had.co.nz/" target="_blank">Hadley Wickham’s R Packages book</a>. To help me remember this stuff, <a href="https://www.rostrum.blog/2019/11/01/usethis/" target="_blank">I also wrote some slides about developing a package from scratch</a> with {usethis} functions.</p>
</div>
<div id="drake" class="section level2">
<h2>{drake}</h2>
<p>Your analysis has got 12 input data files. They pass through 15 functions There are some computationally-intensive, long-running processes. Plots and tables are produced and R Markdown files are rendered. How do you keep on top of this? Is it enough to have a set of numbered script files (<code>01_read.R</code>, etc) or a single script file that sources the rest? What if something changes? Do you have to re-run everything from scratch?</p>
<p>You need a workflow manager. Save yourself some hassle and use <a href="https://wlandau.github.io/" target="_blank">Will Landau</a>‘s <a href="https://docs.ropensci.org/drake/" target="_blank">{drake} package</a>, backed by <a href="https://ropensci.org/blog/2018/02/06/drake/" target="_blank">rOpenSci</a>’s peer review process. {drake} ’remembers’ all the dependencies between files and only re-runs what needs to be re-run if any errors are found or changes are made. It also provides visualisations of your workflow and allows for high-performance computing.</p>
<p>In short, you:</p>
<ol style="list-style-type: decimal">
<li>Supply the steps of your analysis as functions to <code>drake_plan()</code>, which generates a data frame of commands (functions) to operate over a set of targets (objects)</li>
<li>Run <code>make()</code> on your plan to run the steps and generate the outputs</li>
<li>If required, make changes anywhere in your workflow and re-<code>make()</code> the plan – {drake} will only re-run things that are dependent on what you changed</li>
</ol>
<p>Below is an extreme example from a happy customer (click through to <a href="https://pbs.twimg.com/media/ELljfy5XsAAM8Xv?format=jpg&amp;name=small" target="_blank">the image</a> if you can’t see the embedded tweet). Each point on the graph is an object or function; black ones are out of date and will be updated when <code>make()</code> is next run.</p>
{{% tweet "1205103780938833921" %}}
<p>It’s hard to do {drake} justice in just a few paragraphs, but luckily it’s one of the best-documented packages out there. Take a look at:</p>
<ul>
<li>the <a href="https://github.com/ropensci/drake" target="_blank">{drake} rOpenSci website</a></li>
<li>the <a href="https://books.ropensci.org/drake/" target="_blank">thorough user manual</a></li>
<li>the <a href="https://github.com/wlandau/learndrake" target="_blank">learndrake GitHub repo</a>, which can be launched in the cloud</li>
<li>the <a href="https://wlandau.shinyapps.io/drakeplanner/" target="_blank">drakeplanner Shiny app</a></li>
<li>Will’s <a href="https://wlandau.github.io/drake-examples/" target="_blank">{drake} examples page</a></li>
<li>this <a href="https://ropensci.org/commcalls/2019-09-24/" target="_blank">rOpenSci community call</a></li>
<li>a <a href="https://joss.theoj.org/papers/10.21105/joss.00550" target="_blank">Journal of Open Source Software (JOSS) paper</a></li>
<li>more things listed in <a href="https://books.ropensci.org/drake/index.html#documentation" target="_blank">the documentation section of the user manual</a></li>
</ul>
<p>I <a href="https://ropensci.org/commcalls/2019-09-24/" target="_blank">wrote about {drake} earlier in the year</a> and <a href="https://github.com/matt-dray/drake-egg-rap" target="_blank">made a demo</a> and <a href="https://github.com/matt-dray/drake-egg-rap/blob/master/docs/drake-presentation.pdf" target="_blank">some slides</a>. I think it could be useful for reproducibility of statistical publications in particular.</p>
</div>
<div id="purrr" class="section level2">
<h2>{purrr}</h2>
<p>You want to apply a function over the elements of some list or vector.</p>
<p>The <code>map()</code> family of functions from <a href="https://purrr.tidyverse.org/" target="_blank">the {purrr} package</a>–by <a href="https://twitter.com/_lionelhenry?lang=en" target="_blank">Lionel Henry</a> and <a href="http://hadley.nz/" target="_blank">Hadley Wickham</a> of <a href="https://rstudio.com/" target="_blank">RStudio</a>–has a concise and consistent syntax for doing this.</p>
<p>You can choose what gets returned from your iterations by selecting the appropriate <code>map_*()</code> variant: <code>map()</code> for a list, <code>map_df()</code> for a data frame, <code>map_chr()</code> for a character vector and so on. Here’s a trivial example that counts the number of <a href="https://en.wikipedia.org/wiki/Street_Fighter_II:_The_World_Warrior" target="_blank">Street Fighter</a> characters from selected continents. Here’s a list:</p>
<pre class="r"><code># Create the example list
street_fighter &lt;- list(
 china = &quot;Chun Li&quot;, japan = c(&quot;Ryu&quot;, &quot;E Honda&quot;),
 usa = c(&quot;Ken&quot;, &quot;Guile&quot;, &quot;Balrog&quot;), `???` = &quot;M Bison&quot;
)

street_fighter  # take a look at the list</code></pre>
<pre><code>## $china
## [1] &quot;Chun Li&quot;
## 
## $japan
## [1] &quot;Ryu&quot;     &quot;E Honda&quot;
## 
## $usa
## [1] &quot;Ken&quot;    &quot;Guile&quot;  &quot;Balrog&quot;
## 
## $`???`
## [1] &quot;M Bison&quot;</code></pre>
<p>Now to map the <code>length()</code> function to each element of the list and return a named integer vector.</p>
<pre class="r"><code>library(purrr)  # load the package

# Get the length of each list element
purrr::map_int(
  street_fighter,  # list
  length           # function
)</code></pre>
<pre><code>## china japan   usa   ??? 
##     1     2     3     1</code></pre>
<p>But what if you want to iterate over two or more elements? You can use <code>map2()</code> or <code>pmap()</code>. And what if you want to get the side effects? <code>walk()</code> and <code>pwalk()</code>.</p>
<p>{purrr} is also great for working with data frames with columns that contain lists (listcols), like the <code>starwars</code> data from the {dplyr} package. Let’s use the <code>length()</code> function again, but in the context of a listcol, to get the characters in the most films.</p>
<pre class="r"><code># Load packages
suppressPackageStartupMessages(library(dplyr))
library(purrr)

# map() a listcol within a mutate() call
starwars %&gt;% 
  mutate(films_count = map_int(films, length)) %&gt;% 
  select(name, films, films_count) %&gt;% 
  arrange(desc(films_count)) %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 3
##   name           films     films_count
##   &lt;chr&gt;          &lt;list&gt;          &lt;int&gt;
## 1 R2-D2          &lt;chr [7]&gt;           7
## 2 C-3PO          &lt;chr [6]&gt;           6
## 3 Obi-Wan Kenobi &lt;chr [6]&gt;           6
## 4 Luke Skywalker &lt;chr [5]&gt;           5
## 5 Leia Organa    &lt;chr [5]&gt;           5
## 6 Chewbacca      &lt;chr [5]&gt;           5</code></pre>
<p>Why not just write a loop or use the <code>*apply</code> functions? <a href="https://jennybc.github.io/purrr-tutorial/bk01_base-functions.html" target="_blank">Jenny Bryan has a good {purrr} tutorial</a> that explains why you might consider either choice. Basically, do what you feel; I like the syntax consistency and the ability to predict what function I need based on its name.</p>
<p>Check out the excellent <a href="https://github.com/rstudio/cheatsheets/blob/master/purrr.pdf" target="_blank">{purrr} cheatsheet</a> for some prompts and excellent visual guidance.</p>
</div>
</div>
<div id="honourable-mentions" class="section level1">
<h1>Honourable mentions</h1>
<div id="blogdown" class="section level2">
<h2>{blogdown}</h2>
<p>This blog, and I’m sure <a href="https://awesome-blogdown.com/" target="_blank">many others</a>, wouldn’t exist without <a href="https://github.com/rstudio/blogdown/blob/master/README.md" target="_blank">{blogdown}</a> by <a href="https://yihui.org/" target="_blank">Yihui Xie</a>. {blogdown} lets you write and render R Markdown files into blog posts via static site generators like <a href="https://gohugo.io/" target="_blank">Hugo</a>. This is brilliant if you’re trying to get R output into a blog post with minimal fuss. <a href="https://bookdown.org/yihui/blogdown/" target="_blank">The {blogdown} book</a> by Yihui, <a href="https://amber.rbind.io/" target="_blank">Amber Thomas</a>, <a href="https://alison.rbind.io/" target="_blank">Alison Presmanes Hill</a> is particularly helpful.</p>
</div>
<div id="xaringan" class="section level2">
<h2>{xaringan}</h2>
<p><a href="https://slides.yihui.org/xaringan/#1" target="_blank">{xaringan}</a> is another great package from <a href="https://yihui.org/" target="_blank">Yihui Xie</a> that lets you turn R Markdown into a slideshow using <a href="http://remarkjs.com/" target="_blank">remark.js</a>. It’s very customisable via CSS, to the extent that I was able <a href="https://www.rostrum.blog/2019/05/24/xaringan-template/" target="_blank">to mimic the house style of my organisation</a> this year. One of my favourite functions<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> is <code>inf_mr()</code> (Infinite Moon Reader), which lets you <a href="https://yihui.org/en/2019/02/ultimate-inf-mr/" target="_blank">live-preview your outputs as they’re written</a>.</p>
</div>
<div id="polite" class="section level2">
<h2>{polite}</h2>
<p>Web scraping is ethically dubious if you fail to respect the terms of the sites you’re visiting. <a href="https://www.ddrive.no/" target="_blank">Dmytro Perepolkin</a> has made it easy to be a good citizen of the internet with <a href="https://dmi3kno.github.io/polite/" target="_blank">the {polite} package</a>, which has just hit version 1.0.0 and is on CRAN (congratulations!). First you introduce yourself to the site with a <code>bow()</code> and collect any information about limits and no-go pages from <a href="http://www.robotstxt.org/robotstxt.html" target="_blank">the robots.txt file</a>, then you can modify search paths with a <code>nod()</code> and collect information from them with a <code>scrape()</code>. Very responsible.</p>
</div>
<div id="arsenal" class="section level2">
<h2>{arsenal}</h2>
<p>I’ve been using the handy<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> {arsenal} package to compare data frames as part of a quality assurance process. First, you supply two data frames to <code>comparedf()</code> to create a ‘compare’ object. Run <code>diffs()</code> on that object to create a new data frame where each row is a mismatch, given a tolerance, with columns for the location and values that are causing problems. We managed to quality assure nearly a million values with this method in next to no time. <a href="https://cran.r-project.org/web/packages/arsenal/vignettes/comparedf.html" target="_blank">Check out their vignette</a> on how to do this.</p>
</div>
</div>
<div id="bonus" class="section level1">
<h1>Bonus!</h1>
<div id="govdown" class="section level2">
<h2>{govdown}</h2>
<p>Aha, well done for reading this far. As a bonus, I’m calling out <a href="https://twitter.com/nacnudus" target="_blank">Duncan Garmonsway</a>’s <a href="https://ukgovdatascience.github.io/govdown/" target="_blank">{govdown} package</a>. Duncan grappled with the complexities of things like Pandoc and Lua filters to build a package that applies the accessibility-friendly <a href="https://design-system.service.gov.uk/" target="_blank">GOV.UK design system</a> to R Markdown. This means you can create things like the <a href="https://ukgovdatascience.github.io/rap-website/" target="_blank">the Reproducible Analaytical Pipelines (RAP) website</a> in the style of <a href="https://www.gov.uk/" target="_blank">GOV.UK</a>. <a href="https://twitter.com/nacnudus/status/1186600342072516608" target="_blank">Endorsed by Yihui Xie himself</a>! Check out Duncan’s <a href="https://nacnudus.github.io/spreadsheet-munging-strategies/" target="_blank">{tidyxl} and {unpivotr} packages for handling nightmare Excel files</a> while you’re at it.</p>
<hr />
<details>
<p><summary>Session info</summary></p>
<pre><code>## [1] &quot;Last updated 2020-01-02&quot;</code></pre>
<pre><code>## ─ Session info ───────────────────────────────────────────────────────────────
##  setting  value                       
##  version  R version 3.6.1 (2019-07-05)
##  os       macOS Sierra 10.12.6        
##  system   x86_64, darwin15.6.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_GB.UTF-8                 
##  ctype    en_GB.UTF-8                 
##  tz       Europe/London               
##  date     2020-01-02                  
## 
## ─ Packages ───────────────────────────────────────────────────────────────────
##  package     * version    date       lib source                     
##  assertthat    0.2.1      2019-03-21 [1] CRAN (R 3.6.0)             
##  backports     1.1.5      2019-10-02 [1] CRAN (R 3.6.0)             
##  blogdown      0.17       2019-11-13 [1] CRAN (R 3.6.0)             
##  bookdown      0.16       2019-11-22 [1] CRAN (R 3.6.0)             
##  cli           2.0.0      2019-12-09 [1] CRAN (R 3.6.1)             
##  crayon        1.3.4      2017-09-16 [1] CRAN (R 3.6.0)             
##  digest        0.6.23     2019-11-23 [1] CRAN (R 3.6.0)             
##  dplyr       * 0.8.3      2019-07-04 [1] CRAN (R 3.6.0)             
##  emo           0.0.0.9000 2019-12-23 [1] Github (hadley/emo@3f03b11)
##  evaluate      0.14       2019-05-28 [1] CRAN (R 3.6.0)             
##  fansi         0.4.0      2018-10-05 [1] CRAN (R 3.6.0)             
##  glue          1.3.1      2019-03-12 [1] CRAN (R 3.6.0)             
##  htmltools     0.4.0      2019-10-04 [1] CRAN (R 3.6.0)             
##  knitr         1.26       2019-11-12 [1] CRAN (R 3.6.0)             
##  lubridate     1.7.4      2018-04-11 [1] CRAN (R 3.6.0)             
##  magrittr      1.5        2014-11-22 [1] CRAN (R 3.6.0)             
##  pillar        1.4.3      2019-12-20 [1] CRAN (R 3.6.0)             
##  pkgconfig     2.0.3      2019-09-22 [1] CRAN (R 3.6.0)             
##  purrr       * 0.3.3      2019-10-18 [1] CRAN (R 3.6.0)             
##  R6            2.4.1      2019-11-12 [1] CRAN (R 3.6.0)             
##  Rcpp          1.0.3      2019-11-08 [1] CRAN (R 3.6.0)             
##  rlang         0.4.2      2019-11-23 [1] CRAN (R 3.6.0)             
##  rmarkdown     2.0        2019-12-12 [1] CRAN (R 3.6.0)             
##  rstudioapi    0.10       2019-03-19 [1] CRAN (R 3.6.0)             
##  sessioninfo   1.1.1      2018-11-05 [1] CRAN (R 3.6.0)             
##  stringi       1.4.3      2019-03-12 [1] CRAN (R 3.6.0)             
##  stringr       1.4.0      2019-02-10 [1] CRAN (R 3.6.0)             
##  tibble        2.1.3      2019-06-06 [1] CRAN (R 3.6.0)             
##  tidyselect    0.2.5      2018-10-11 [1] CRAN (R 3.6.0)             
##  utf8          1.1.4      2018-05-24 [1] CRAN (R 3.6.0)             
##  vctrs         0.2.1      2019-12-17 [1] CRAN (R 3.6.1)             
##  withr         2.1.2      2018-03-15 [1] CRAN (R 3.6.0)             
##  xfun          0.11       2019-11-12 [1] CRAN (R 3.6.0)             
##  yaml          2.2.0      2018-07-25 [1] CRAN (R 3.6.0)             
##  zeallot       0.1.0      2018-01-28 [1] CRAN (R 3.6.0)             
## 
## [1] /Users/matt.dray/Library/R/3.6/library
## [2] /Library/Frameworks/R.framework/Versions/3.6/Resources/library</code></pre>
</details>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Along with <a href="https://yihui.org/en/2019/03/yolo-karl/" target="_blank"><code>yolo: true</code></a>, of course.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p><a href="https://www.bbc.co.uk/sport/cricket/50803748" target="_blank">Unlike Arsenal FC in 2019</a>, rofl.<a href="#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>
