---
title: Art of the Possible
author: Matt Dray
date: '2018-11-01'
slug: art-of-the-possible
draft: yes
---

Matt Dray

# Search by colour

You can search a collection of images by their colour content, ordering them by that colour's dominance in each image. Some examples:

* [Google Arts & Culture](https://artsexperiments.withgoogle.com/artpalette/colors/a46053-433932-c2ad8f-b5996a-746251)
* [Designspiration](https://www.designspiration.net/search/saves/?q=%2389ebd7%20%23afff11%20%23e5ff91%20%23ff9775%20%23f38d00)
* [TinEye Multicolr](https://labs.tineye.com/multicolr/)
* [Google Advanced Image Search](https://www.google.co.uk/advanced_image_search)
* [Dulux colour match](https://www.dulux.co.uk/en/articles/dulux-visualizer-app)

 
Could we do something similar to this in R?

# Quick note on colours

There are _lots_ of colours. To keep things simple, let's say 'green' instead of olive drab.[^1]

Also I'm colourblind so don't believe anything I say.

# The process

So what we need to do is:

1. Read in an image
2. Map a set of simplified colours to that image
3. Quantify the colours

# It's a kind of ImageMagick

The `magick` R package is an implementation of [ImageMagick, an open-source software suite whose emphasis is image manipulation from the command line](https://www.imagemagick.org/script/index.php). The flexibility of `magick` can be seen in the [vignette](https://cran.r-project.org/web/packages/magick/vignettes/intro.html).

`magick` was created and is maintained by [Jeroen Ooms](https://twitter.com/opencpu?lang=en), a software engineer and postdoc at [ROpenSci](https://ropensci.org/), a collective that seeks [to develop tools for open and reproducible research](https://ropensci.org/packages/).

[ROpenSci hosted recently a worjshop from Ooms about working with images in R](https://ropensci.org/blog/2018/10/24/commcall-nov2018/), which caught my attention.


```{r}
# Simplify image colours to prespecified simple colour set
# Following Jeroen Ooms (https://jeroen.github.io/munster2018/)

library(magick)
library(dplyr)
library(tibble)

# read test image

# img_path <- "https://upload.wikimedia.org/wikipedia/commons/1/13/Suprematist_Composition_-_Kazimir_Malevich.jpg"
img_path <- "https://www.mchampetier.com/sitephp/images/hd/9zy_Joan_Miro_oct176.jpg"

test_img <- magick::image_read(
  img_path
) %>%  # read image as a magick class object
  image_scale(geometry = c("x250"))  # resize to width of 250px

# Generate named vector of 'simple' colours

cols_vec <- setNames(
  c("#000000", "#0000ff", "#008000", "#ff0000", "#ffffff", "#ffff00"),
  c("black", "blue", "green", "red", "white", "yellow")
)

# For each vector element (colour) create a square of that colour

for (i in seq_along(cols_vec)) {
  fig_name <- paste0(names(cols_vec)[i], "_square")  # create object name
  assign(
    fig_name,  # set name
    image_graph(width = 100, height = 100, res = 300)  # create magick object
  )
  par(mar = rep(0, 4))  # set plot margins
  plot.new()  # new graphics frame
  rect(0, 0, 1, 1, col = cols_vec[i], border = cols_vec[i])  # build rectangle
  assign(fig_name, magick::image_crop(get(fig_name), "50x50+10+10")) # crop
  dev.off()  # shut down plotting device
  rm(i, fig_name)  # clear up
}

# Generate names of the coloure dsquare objects

col_square <- paste0(names(cols_vec), "_square")

# Combine magick objects (coloured squares)

simple_cols <- image_append(c(
    get(col_square[1]),
    get(col_square[2]),
    get(col_square[3]),
    get(col_square[4]),
    get(col_square[5]),
    get(col_square[6])
  ))

# Map the simple colours to the image

img_mapped <- image_map(test_img, simple_cols)

# Display the original and simplified images side by side

image_append(c(test_img, img_mapped))

# Function to count the colours (adapted from Jeroen Ooms)

count_colors <- function(image) {
  data <- image_data(image) %>%
    apply(2:3, paste, collapse = "") %>% 
    as.vector %>% table() %>%  as.data.frame() %>% 
    setNames(c("hex", "freq"))
  data$hex <- paste("#", data$hex, sep="")
  return(data)
}

# Dataframe of dominant colours 

col_freq <- img_mapped %>%
  count_colors() %>%
  left_join(
    as_tibble(cols_vec) %>%
      rownames_to_column() %>%
      rename(hex = value, name = rowname),
    by = "hex"
  ) %>% 
  arrange(desc(freq)) %>% 
  mutate(percent = freq/sum(freq)) %>% 
  select(name, hex, freq, percent)

col_freq
```

# Session info

```{r eval=FALSE}
devtools::session_info()
```
[^1]: There are [five named shares of olive drab](http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf) in R.]