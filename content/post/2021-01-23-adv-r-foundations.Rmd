---
title: 'Advanced R: anchovy pizza'
author: 'Matt Dray'
date: '2021-01-23'
slug: adv-r-names
categories:
  - code
tags:
  - advanced-r
  - book
  - learning
  - pizza
  - r
draft: yes
---

<div class="figure">
<img src="/post/2021-01-23-adv-r-foundations_files/pizza.gif" alt="Bird's-eye view of Five large margherita pizzas on a table before and after consumption" width="75%"/>
</div>

# tl;dr

I bought [Hadley Wickham](http://hadley.nz/)'s [Advanced R](https://adv-r.hadley.nz/) book[^buy] to help me better understand R's quirks. Can names and values (chapter 2) be explained with a contrived pizzeria analogy?[^royale]

# Binding basics

Welcome to the pizzeria. Our specialty is _pizza alla napoletana_, which is topped with mozzarella, tomatoes and freshly caught anchovies.

```{r}
# Create a character-vector object
napoletana <- napoletana <- c("🧀", "🍅", "🐟")
```

The English version of the menu calls it 'Neapolitan pizza', but it's exactly the same thing.

```{r}
# Copy the object
neapolitan <- napoletana
```

Unique topping lists are stored in our recipe books with a special reference code.

```{r}
# The {lobstr} package for understaning object structures
library(lobstr)

# Get the specific object 'address' in your computer's memory
# Both names point to the same object
obj_addr(napoletana)
obj_addr(neapolitan)
```

The pizzaiolos don't care: _napoletana_, Neapolitan; different name, same pizza.

<div class="tip">
`r emo::ji("book")`  "The object, or value, doesn't have a name; it's actually _the name that has a value_" (page 19)
</div>

# Copy on modify

We recently added _pizza pugliese_ to the menu. We just copied the Neapolitan recipe and swapped the anchovies for onions.

```{r}
# Copy the object, update one value
pugliese <- napoletana
pugliese[[3]] <- "🧅"
```

The two pizzas had the same special recipe code until the anchovy-onion switcheroo.

We needed a whole new code after the change.

```{r}
# Now the names point to different objects
# We modified the copy, so it becomes a new object in memory
obj_addr(napoletana)
obj_addr(pugliese)
```

<div class="tip">
`r emo::ji("book")` "This behaviour is called _copy-on-modify_" (page 22)
</div>

Here's the entries in the recipe book for these pizzas.

```{r}
knitr::kable(
  tibble::tribble(
    ~Code, ~Name, ~`Additional topping`, 
    obj_addr(napoletana), "Pizza alla napoletana", napoletana[3],
    obj_addr(neapolitan), "Neapolitan pizza", neapolitan[3], 
    obj_addr(pugliese), "Pizza pugliese", pugliese[3]
  )
)
```

Two names refer to the anchovy pizza and one name points to the onion pizza. 

# Lists

Our knowledge management system was a bit inefficient: the mozzarella and tomato toppings exist twice in our recipe book, once for each pizza.

So we updated our recipe system to store each topping separately with their own special reference codes too.

Again, we wrote down the _napoletana_ toppings, copied them and switched the anchovies for onions.

```{r}
# Store toppings as list elements instead of a vector
# Copy the list, modify an element
napoletana <- list("🧀", "🍅", "🐟")
pugliese <- napoletana
pugliese[[3]] <- "🧅"
```

The two pizzas again have different codes in our recipe book. Not a surprise.

But now the pizzas both point to the same codes for mozzarella and tomato. Much more efficient (especially if we expand our menu to more than two pizzas[^damichele]).

```{r}
# Compare addresses in memory for the lists
# Only the modified element was updated; not the whole list
ref(
  napoletana,  # the original
  pugliese     # the modified copy
)
```

Each recipe points to a different place for its unique additional topping, of course.

<div class="tip"> 
`r emo::ji("book")`
"This list is more complex [than a vector] because instead of storing the values itself, it stores _references to them_" (page 25)
</div>

# Data frames

How do we manage orders? Wait staff put each order in a column, with a row for each topping.

Let's say a couple orders a _napoletana_ and a _pugliese_.

```{r}
# Create a data.frame, which is a list of vectors
order <- data.frame(
  napoletana = c("🧀", "🍅", "🐟"),
  pugliese = c("🧀", "🍅", "🧅")
)

knitr::kable(order)
```

The customer who ordered the _napoletana_ is hungry — more anchovies!

```{r}
# Copy the object and modify one row in one column
order_update <- order
order_update[3, 1] <- "🐟🐟" 
knitr::kable(order_update)
```

We use a code reference system for our orders too. 

The _napoletana_ was modified after it was copied, so the code for that pizza was updated. The _pugliese_ didn't change, so its code is maintained.

since one of the pizza orders was changed, our reference code for the entire order was changed too

```{r}
# Compare addresses in memory for the data.frames
# The whole column (a vector, remember) was replaced
ref(
  order,        # the original
  order_update  # the modified copy
)
```

<div class="tip">
`r emo::ji("book")`
"If you modify a column, only that column needs to be modified" (page 26)
</div>

At this point, both customers also decide to order extra mozzarella. Of course you would!

The waiter again copies the order and changes the cheese row for both pizzas.

```{r}
# Copy the data.frame object, modify a row
order_final <- order_update
order_final[1, 1:2] <- "🧀🧀"
knitr::kable(order_final)
```

Altering the cheese row means both pizza columns are copied and given new codes. Of course, the order gets a whole new code of its own because the toppings were changed.

```{r}
# Compare addresses in memory for the data.frames
# All columns were replaced (modifying a row modifies all columns)
ref(
  order,       # the original
  order_final  # the modified copy
)
```

<div class="tip"> 
`r emo::ji("book")` "If you modify a row, every column is modified, which means every column must be copied" (page 27) 
</div>

_Buon appetito_.

---
<details><summary>Session info</summary>
```{r sessioninfo, echo=FALSE}
sessioninfo::session_info()
```
</details>

[^buy]: You can [buy the book](https://www.amazon.com/gp/product/0815384572/ref=as_li_tl?ie=UTF8&tag=hadlwick-20&camp=1789&creative=9325&linkCode=as2&creativeASIN=0815384572&linkId=9f8b9df5da858c12a5e9905aea66bf08), or [view it for free online](https://adv-r.hadley.nz/).
[^royale]: Initially I went with a metaphor about how a Quarter Pounder with Cheese is called a Royale with Cheese in Paris (or indeed, a Krusty Burger with Cheese is called a Quarter Pounder with Cheese at McDonald's), but the pop culture reference was better than the actual utility of the metaphor.
[^damichele]: Of course, if you're really serious about pizza, you only offer marianara and margherita [as per L'antica Pizzeria Da Michele](http://www.damichele.net/le-nostre-pizze/), which is where I took the photos that are in this post.