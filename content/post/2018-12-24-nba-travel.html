---
title: The NBA Northwest Division with gmapsdistance
author: Matt Dray
date: '2018-12-24'
slug: nba-travel
categories:
  - R
tags:
  - nba
  - gmapsdistance
  - dplyr
  - rvest
  - stringr
  - stringi
  - leaflet
  - tidyr
draft: yes
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="/rmarkdown-libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="/rmarkdown-libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>
<script src="/rmarkdown-libs/leaflet-providers/leaflet-providers.js"></script>
<script src="/rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>
<link href="/rmarkdown-libs/leaflet-awesomemarkers/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-awesomemarkers/leaflet.awesome-markers.min.js"></script>
<link href="/rmarkdown-libs/ionicons/ionicons.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/leaflet-measure/leaflet-measure.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-measure/leaflet-measure.min.js"></script>


<p>Matt Dray (<a href="https://www.twitter.com/mattdray">@mattdray</a>)</p>
<div class="figure">
<img src="https://media.giphy.com/media/GOIl4CelYNleM/giphy.gif" alt="Classic Jazz: Stockton to Malone for the dunk (via Giphy)" />
<p class="caption">Classic Jazz: Stockton to Malone for the dunk (<a href="https://giphy.com/gifs/vintage-basketball-GOIl4CelYNleM">via Giphy</a>)</p>
</div>
<div id="tldr" class="section level1">
<h1>TL;DR</h1>
<p>The <code>gmapsdistance</code> R package lets you query the Google Maps API. I used it to look at travel distances between basketball teams. Surprise: they can be far apart even if they’re in the same division.</p>
</div>
<div id="the-nba" class="section level1">
<h1>The NBA</h1>
<p>The USA is pretty big.</p>
<p>So the National Basketball Association (NBA) is separated geographically into Eastern and Western conferences, each with three divisions of five teams. The majority of match-ups are <a href="https://en.wikipedia.org/wiki/National_Basketball_Association#Regular_season">within the division and conference</a>.</p>
<p>This is fine for the Central division: teams clustered near Lakes Michigan and Erie.</p>
<p>But not for the Northwest division: it stretches from Portland in the Pacific Northwest to Oklahoma City in the centre-south, with Salt Lake City and Denver between. The other team is in Minneapolis; much closer to the Central division.</p>
<div class="figure">
<img src="/post/2018-12-18-googlemaps-in-the-nba-pacific-division_files/nba-map-wiki.png" alt="NBA team locations with states coloured by division (CC BY-SA 2.5, Wikipedia)" />
<p class="caption">NBA team locations with states coloured by division (CC BY-SA 2.5, <a href="https://en.wikipedia.org/wiki/National_Basketball_Association#/media/File:Map_of_USA_and_Canada,_NBA,_zoom.svg">Wikipedia</a>)</p>
</div>
<p>That’s a lot of travel for fans.</p>
</div>
<div id="google-maps-and-gmapsdistance" class="section level1">
<h1>Google Maps and <code>gmapsdistance</code></h1>
<p>If you didn’t know, Google Maps is one of many services that calculates journey distances and durations. The R package <a href="https://CRAN.R-project.org/package=gmapsdistance"><code>gmapsdistance</code></a> was written by Rodrigo Azuero, Demetrio Rodriguez and David Zarruk. It wraps the <a href="https://www.google.co.uk/maps">Google Maps</a> <a href="https://medium.freecodecamp.org/what-is-an-api-in-english-please-b880a3214a82">Application Programming Interface (API)</a>. You can use it to get travel distance and time for several modes of travel.</p>
<p>You need an API key for Google Maps. This helps prevent misuse of the service and helps keeps track of your credit. The process is outlined in detail in <a href="https://developers.google.com/maps/documentation/distance-matrix/get-api-key#key">the Google developer documentation pages</a>. <a href="https://cloud.google.com/maps-platform/">Go to the Google Cloud maps platform pages</a> and follow the instructions. You’ll need a Google account to do this.</p>
<div class="figure">
<img src="/post/2018-12-18-nba-travel_files/1-select-product.png" alt="Setting up Google Maps platform on Google Cloud" />
<p class="caption">Setting up Google Maps platform on Google Cloud</p>
</div>
</div>
<div id="get-data" class="section level1">
<h1>Get data</h1>
<p>We can scrape the <a href="https://en.wikipedia.org/wiki/National_Basketball_Association">NBA Wikipedia page</a> with the <a href="https://github.com/hadley/rvest"><code>rvest</code> package</a> to get a table of teams and locations.</p>
<p>Start by loading <code>rvest</code> and some other packages for data manipulation.</p>
<pre class="r"><code>library(dplyr)  # data manipulation and %&gt;%
library(tidyr)  # tidying dataframes
library(stringr); library(stringi)  # string manipulation
library(rvest)  # web scraping
library(knitr)  # print tables nicely</code></pre>
<p>We can extrac the table with its xpath, which is like an ‘address’ for HTML content. You can use the ‘inspect’ function in your browser or <a href="https://selectorgadget.com/">the selectorgadget browser extension</a> to get this information.</p>
<pre class="r"><code># Read the HTML from a specified web URL
html &lt;- read_html(&quot;https://en.wikipedia.org/wiki/National_Basketball_Association&quot;)

# Use selectorgadget or your browser&#39;s &#39;inspect&#39; mode to get xpath
table_xpath &lt;- &#39;//*[@id=&quot;mw-content-text&quot;]/div/table[4]&#39;</code></pre>
<p>Now we can collect the table and get the parts we want: team names and locations. We can get the latter as both latitude-longitude coordinates and as text. Text can be parsed by Google Maps if words are separated by the plus symbol: <code>arena+city+state</code>. Steps to do this are annotated in the code below.</p>
<pre class="r"><code>nba_table &lt;-
  # Read HTML, isolate table, focus on NW
  html_nodes(x = html, xpath = table_xpath) %&gt;%  # scrape the HTML
  html_table(fill = TRUE, header = NA) %&gt;%  # parse as table
  as.data.frame() %&gt;%  # convert from list
  filter(Division == &quot;Northwest&quot;) %&gt;%  # NW division only
  # Isolate the latitude and longitude
  separate(Coordinates, c(&quot;Coords1&quot;, &quot;Coords2&quot;, &quot;Coords3&quot;), &quot; / &quot;) %&gt;% 
  separate(Coords3, c(&quot;Latitude&quot;, &quot;Longitude&quot;), sep = &quot;; &quot;) %&gt;% 
  separate(Longitude, c(&quot;Longitude&quot;, &quot;X&quot;), sep = &quot; \\(&quot;) %&gt;% 
  mutate(
    # Make coordinates numeric
    Latitude = as.numeric(Latitude),  # make numeric
    Longitude = stri_escape_unicode(Longitude),  # there&#39;s a weird character
    Longitude = str_replace(Longitude, &quot;\\\\ufeff&quot;, &quot;&quot;),  # remove it
    Longitude = as.numeric(Longitude),  # make numeric
    # Create text search string
    Search = paste(Arena, City.State),  # combine location details
    Search = str_replace_all(Search, &quot;,&quot;, &quot;&quot;),  # replace comma with blank
    Search = str_replace_all(Search, &quot; &quot;, &quot;+&quot;),  # replace space with plus
    # Add three-letter team codes to help simplify outputs
    `Team code` = case_when(
      Team == &quot;Denver Nuggets&quot; ~ &quot;DEN&quot;,
      Team == &quot;Minnesota Timberwolves&quot; ~ &quot;MIN&quot;,
      Team == &quot;Oklahoma City Thunder&quot; ~ &quot;OKC&quot;,
      Team == &quot;Portland Trail Blazers&quot; ~ &quot;POR&quot;,
      Team == &quot;Utah Jazz&quot; ~ &quot;UTA&quot;
    )
  ) %&gt;% 
  select(  # Retain columns of interest only
    Team, `Team code`,
    Arena, City = City.State,
    Latitude, Longitude, Search
  )

# Print a simple version of the table
select(nba_table, `Team code`, Latitude, Longitude, Search) %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Team code</th>
<th align="right">Latitude</th>
<th align="right">Longitude</th>
<th align="left">Search</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DEN</td>
<td align="right">39.74861</td>
<td align="right">-105.00750</td>
<td align="left">Pepsi+Center+Denver+Colorado</td>
</tr>
<tr class="even">
<td align="left">MIN</td>
<td align="right">44.97944</td>
<td align="right">-93.27611</td>
<td align="left">Target+Center+Minneapolis+Minnesota</td>
</tr>
<tr class="odd">
<td align="left">OKC</td>
<td align="right">35.46333</td>
<td align="right">-97.51500</td>
<td align="left">Chesapeake+Energy+Arena+Oklahoma+City+Oklahoma</td>
</tr>
<tr class="even">
<td align="left">POR</td>
<td align="right">45.53167</td>
<td align="right">-122.66667</td>
<td align="left">Moda+Center+Portland+Oregon</td>
</tr>
<tr class="odd">
<td align="left">UTA</td>
<td align="right">40.76833</td>
<td align="right">-111.90111</td>
<td align="left">Vivint+Smart+Home+Arena+Salt+Lake+City+Utah</td>
</tr>
</tbody>
</table>
</div>
<div id="map-locations" class="section level1">
<h1>Map locations</h1>
<p>We can map the latitude and longitude for fun.</p>
<pre class="r"><code>library(leaflet)  # for interactive maps

leaflet(nba_table) %&gt;%
  fitBounds(lng1 = -125, lng2 = -90, lat1 = 34, lat2 = 46) %&gt;% 
  addProviderTiles(providers$Stamen.TonerLite) %&gt;%
  addAwesomeMarkers(
    lng = ~Longitude, lat = ~Latitude,
    popup = ~paste0(
      &quot;&lt;b&gt;&quot;, nba_table$Team, &quot;&lt;/b&gt;&quot;,
      &quot;&lt;br&gt;&quot;, nba_table$Arena,
      &quot;&lt;br&gt;&quot;, nba_table$City
    ),
    icon = awesomeIcons(
      library = &quot;ion&quot;, icon = &quot;ion-ios-basketball&quot;, # add icon
      markerColor = case_when(
        nba_table$`Team code` == &quot;DEN&quot; ~ &quot;darkblue&quot;,
        nba_table$`Team code` == &quot;MIN&quot; ~ &quot;darkblue&quot;,
        nba_table$`Team code` == &quot;OKC&quot; ~ &quot;blue&quot;,
        nba_table$`Team code` == &quot;POR&quot; ~ &quot;black&quot;,
        nba_table$`Team code` == &quot;UTA&quot; ~ &quot;darkblue&quot;
      ),
      iconColor = case_when(  # see teamcolorcodes.com
        nba_table$`Team code` == &quot;DEN&quot; ~ &quot;#FEC524&quot;,
        nba_table$`Team code` == &quot;MIN&quot; ~ &quot;#9EA2A2&quot;,
        nba_table$`Team code` == &quot;OKC&quot; ~ &quot;#EF3B24&quot;,
        nba_table$`Team code` == &quot;POR&quot; ~ &quot;#E03A3E&quot;,
        nba_table$`Team code` == &quot;UTA&quot; ~ &quot;#00471B&quot;
      )
    )
  ) %&gt;%
  addMeasure()</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"fitBounds":[34,-125,46,-90,[]],"calls":[{"method":"addProviderTiles","args":["Stamen.TonerLite",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addAwesomeMarkers","args":[[39.748611,44.979444,35.463333,45.531667,40.768333],[-105.0075,-93.276111,-97.515,-122.666667,-111.901111],{"icon":"ion-ios-basketball","markerColor":["darkblue","darkblue","blue","black","darkblue"],"iconColor":["#FEC524","#9EA2A2","#EF3B24","#E03A3E","#00471B"],"spin":false,"squareMarker":false,"iconRotate":0,"font":"monospace","prefix":"ion"},null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["<b>Denver Nuggets<\/b><br>Pepsi Center<br>Denver, Colorado","<b>Minnesota Timberwolves<\/b><br>Target Center<br>Minneapolis, Minnesota","<b>Oklahoma City Thunder<\/b><br>Chesapeake Energy Arena<br>Oklahoma City, Oklahoma","<b>Portland Trail Blazers<\/b><br>Moda Center<br>Portland, Oregon","<b>Utah Jazz<\/b><br>Vivint Smart Home Arena<br>Salt Lake City, Utah"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addMeasure","args":[{"position":"topright","primaryLengthUnit":"feet","primaryAreaUnit":"acres","activeColor":"#ABE67E","completedColor":"#C8F2BE","popupOptions":{"className":"leaflet-measure-resultpopup","autoPanPadding":[10,10]},"captureZIndex":10000,"localization":"en","decPoint":".","thousandsSep":","}]}],"limits":{"lat":[35.463333,45.531667],"lng":[-122.666667,-93.276111]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="get-travel-distances" class="section level1">
<h1>Get travel distances</h1>
<p>We start by making our API key available in the package environment by using the <code>set.api.key()</code> function from <code>gmapsdistance</code>.</p>
<pre class="r"><code>library(gmapsdistance)
set.api.key(&quot;YOUR-API-KEY&quot;)  # replace with your key</code></pre>
<p>The basic arguments to the <code>gmapsdistance()</code> function are the origin and destination (can be an address, postcode or latlong coordinates), the mode of travel (car, public transit, walking) and the return format (shape) of the data (each origin-destination pair per row, or a matrix). We want all possible combinations.</p>
<p>Now we can query Google Maps with the API key. I’ve explained the function arguments in the code comments.</p>
<pre class="r"><code>nba_travel &lt;- 
  gmapsdistance(
    key = get.api.key(),  # retrieve the API key we set in the step above
    origin = nba_table$Search,  # vector of locations from our dataframe
    destination = nba_table$Search,  # as above
    combinations = &quot;all&quot;,  # all possible pairs of locations
    mode = &quot;driving&quot;,  # rather than walking, public transport or cycling
    shape = &quot;long&quot;  # one row per location-pair
  )</code></pre>
<p>I’ve focused here on driving as the mode of transport. Note that you can also do things like set specific start times and dates, but I’ve left these out for simplicity.</p>
</div>
<div id="travel-distance-output" class="section level1">
<h1>Travel distance output</h1>
<p>What does the returned data look like?</p>
<pre class="r"><code>glimpse(nba_travel)</code></pre>
<pre><code>## List of 3
##  $ Time    :&#39;data.frame&#39;:    25 obs. of  3 variables:
##   ..$ or  : Factor w/ 5 levels &quot;Pepsi+Center+Denver+Colorado&quot;,..: 1 2 3 4 5 1 2 3 4 5 ...
##   ..$ de  : Factor w/ 5 levels &quot;Pepsi+Center+Denver+Colorado&quot;,..: 1 1 1 1 1 2 2 2 2 2 ...
##   ..$ Time: num [1:25] 0 47277 34477 65601 27969 ...
##  $ Distance:&#39;data.frame&#39;:    25 obs. of  3 variables:
##   ..$ or      : Factor w/ 5 levels &quot;Pepsi+Center+Denver+Colorado&quot;,..: 1 2 3 4 5 1 2 3 4 5 ...
##   ..$ de      : Factor w/ 5 levels &quot;Pepsi+Center+Denver+Colorado&quot;,..: 1 1 1 1 1 2 2 2 2 2 ...
##   ..$ Distance: num [1:25] 0 1471634 1091108 1997198 835730 ...
##  $ Status  :&#39;data.frame&#39;:    25 obs. of  3 variables:
##   ..$ or    : Factor w/ 5 levels &quot;Pepsi+Center+Denver+Colorado&quot;,..: 1 2 3 4 5 1 2 3 4 5 ...
##   ..$ de    : Factor w/ 5 levels &quot;Pepsi+Center+Denver+Colorado&quot;,..: 1 1 1 1 1 2 2 2 2 2 ...
##   ..$ status: chr [1:25] &quot;OK&quot; &quot;OK&quot; &quot;OK&quot; &quot;OK&quot; ...</code></pre>
<p>It’s a list object with three elements: <code>Time</code>, <code>Distance</code> and <code>Status</code>. Each list element is a dataframe with 25 observations (each team paired with every other) and 3 columns:</p>
<ul>
<li><code>or</code> – the origin point</li>
<li><code>de</code> – the destination point</li>
<li>one of <code>Time</code> in seconds, <code>Distance</code> in metres or <code>Status</code> (whether the request was successful)</li>
</ul>
<p>All our requests returned ‘OK’ for <code>Status</code> so there were no problems with fetching the data.</p>
</div>
<div id="exploring-results" class="section level1">
<h1>Exploring results</h1>
<p>The data is returned in a tidy data frame with one row per origin-destination. We can clean this up by matching three-letter team codes to the data, arranging by distance within origin location and removing rows that provide the distance from each team to themselves (i.e. zero kilometres).</p>
<pre class="r"><code># Create a mini-lookup of search strings to three-letter team codes
nba_lookup &lt;- select(nba_table, `Team code`, Search)

# Make the output table easier to read by joining team codes
nba_distance &lt;- nba_travel$Distance %&gt;%
  left_join(nba_lookup, by = c(&quot;or&quot; = &quot;Search&quot;)) %&gt;% 
  left_join(
    nba_lookup, by = c(&quot;de&quot; = &quot;Search&quot;), suffix = c(&quot; (origin)&quot;, &quot; (destination)&quot;)
  ) %&gt;% 
  mutate(Distance = round(Distance/1000, 1)) %&gt;% # m to km
  select(`Team code (origin)`, `Team code (destination)`, Distance)

# View table
nba_distance %&gt;%
  arrange(`Team code (origin)`, desc(Distance)) %&gt;% 
  filter(Distance != 0) %&gt;%
  rename(`Distance (km)` = Distance) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Team code (origin)</th>
<th align="left">Team code (destination)</th>
<th align="right">Distance (km)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DEN</td>
<td align="left">POR</td>
<td align="right">1996.7</td>
</tr>
<tr class="even">
<td align="left">DEN</td>
<td align="left">MIN</td>
<td align="right">1471.4</td>
</tr>
<tr class="odd">
<td align="left">DEN</td>
<td align="left">OKC</td>
<td align="right">1090.5</td>
</tr>
<tr class="even">
<td align="left">DEN</td>
<td align="left">UTA</td>
<td align="right">836.1</td>
</tr>
<tr class="odd">
<td align="left">MIN</td>
<td align="left">POR</td>
<td align="right">2781.2</td>
</tr>
<tr class="even">
<td align="left">MIN</td>
<td align="left">UTA</td>
<td align="right">1984.8</td>
</tr>
<tr class="odd">
<td align="left">MIN</td>
<td align="left">DEN</td>
<td align="right">1471.6</td>
</tr>
<tr class="even">
<td align="left">MIN</td>
<td align="left">OKC</td>
<td align="right">1270.4</td>
</tr>
<tr class="odd">
<td align="left">OKC</td>
<td align="left">POR</td>
<td align="right">3072.2</td>
</tr>
<tr class="even">
<td align="left">OKC</td>
<td align="left">UTA</td>
<td align="right">1911.6</td>
</tr>
<tr class="odd">
<td align="left">OKC</td>
<td align="left">MIN</td>
<td align="right">1266.9</td>
</tr>
<tr class="even">
<td align="left">OKC</td>
<td align="left">DEN</td>
<td align="right">1091.1</td>
</tr>
<tr class="odd">
<td align="left">POR</td>
<td align="left">OKC</td>
<td align="right">3072.9</td>
</tr>
<tr class="even">
<td align="left">POR</td>
<td align="left">MIN</td>
<td align="right">2782.0</td>
</tr>
<tr class="odd">
<td align="left">POR</td>
<td align="left">DEN</td>
<td align="right">1997.2</td>
</tr>
<tr class="even">
<td align="left">POR</td>
<td align="left">UTA</td>
<td align="right">1230.1</td>
</tr>
<tr class="odd">
<td align="left">UTA</td>
<td align="left">MIN</td>
<td align="right">2002.8</td>
</tr>
<tr class="even">
<td align="left">UTA</td>
<td align="left">OKC</td>
<td align="right">1911.4</td>
</tr>
<tr class="odd">
<td align="left">UTA</td>
<td align="left">POR</td>
<td align="right">1228.9</td>
</tr>
<tr class="even">
<td align="left">UTA</td>
<td align="left">DEN</td>
<td align="right">835.7</td>
</tr>
</tbody>
</table>
</div>
<div id="travel-distance-summaries" class="section level1">
<h1>Travel distance summaries</h1>
<p>It’s trivial to summarise the furthest travel distance within the Northwest division for each team in that division.</p>
<pre class="r"><code>nba_distance %&gt;% 
  arrange(`Team code (origin)`, desc(Distance)) %&gt;%
  group_by(`Team code (origin)`) %&gt;% 
  slice(1) %&gt;% 
  ungroup() %&gt;% 
  arrange(desc(Distance)) %&gt;% 
  rename(`Distance (km)` = Distance) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Team code (origin)</th>
<th align="left">Team code (destination)</th>
<th align="right">Distance (km)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">POR</td>
<td align="left">OKC</td>
<td align="right">3072.9</td>
</tr>
<tr class="even">
<td align="left">OKC</td>
<td align="left">POR</td>
<td align="right">3072.2</td>
</tr>
<tr class="odd">
<td align="left">MIN</td>
<td align="left">POR</td>
<td align="right">2781.2</td>
</tr>
<tr class="even">
<td align="left">UTA</td>
<td align="left">MIN</td>
<td align="right">2002.8</td>
</tr>
<tr class="odd">
<td align="left">DEN</td>
<td align="left">POR</td>
<td align="right">1996.7</td>
</tr>
</tbody>
</table>
<p>Similarly, we can get the total distance each team must travel to each of the others in the Northwest Division.</p>
<pre class="r"><code>nba_distance %&gt;% 
  group_by(`Team code (origin)`) %&gt;% 
  summarise(`Total distance (km)` = sum(Distance)) %&gt;% 
  arrange(desc(`Total distance (km)`)) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Team code (origin)</th>
<th align="right">Total distance (km)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">POR</td>
<td align="right">9082.2</td>
</tr>
<tr class="even">
<td align="left">MIN</td>
<td align="right">7508.0</td>
</tr>
<tr class="odd">
<td align="left">OKC</td>
<td align="right">7341.8</td>
</tr>
<tr class="even">
<td align="left">UTA</td>
<td align="right">5978.8</td>
</tr>
<tr class="odd">
<td align="left">DEN</td>
<td align="right">5394.7</td>
</tr>
</tbody>
</table>
<p>So fans of the Portland Trail Blazers have the furthest total distance to travel to each of the other teams in the Northwest: over 9000 km. That’s about teh same distance as London to Johannesburg in a straight line. Bear in mind these totals are only the travel in one direction as well.</p>
<div id="travel-distance-lookup" class="section level2">
<h2>Travel distance lookup</h2>
<p>Another way to view this is to ‘spread’ the data from long to wide format to create a look-up between origin teams (rows) and destination teams (columns).</p>
<pre class="r"><code># Create easy look-up table for travel distances between teams
nba_distance %&gt;% 
  spread(key = `Team code (destination)`, value = Distance) %&gt;% 
  rename(`Travel distance (km)` = `Team code (origin)`) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Travel distance (km)</th>
<th align="right">DEN</th>
<th align="right">MIN</th>
<th align="right">OKC</th>
<th align="right">POR</th>
<th align="right">UTA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DEN</td>
<td align="right">0.0</td>
<td align="right">1471.4</td>
<td align="right">1090.5</td>
<td align="right">1996.7</td>
<td align="right">836.1</td>
</tr>
<tr class="even">
<td align="left">MIN</td>
<td align="right">1471.6</td>
<td align="right">0.0</td>
<td align="right">1270.4</td>
<td align="right">2781.2</td>
<td align="right">1984.8</td>
</tr>
<tr class="odd">
<td align="left">OKC</td>
<td align="right">1091.1</td>
<td align="right">1266.9</td>
<td align="right">0.0</td>
<td align="right">3072.2</td>
<td align="right">1911.6</td>
</tr>
<tr class="even">
<td align="left">POR</td>
<td align="right">1997.2</td>
<td align="right">2782.0</td>
<td align="right">3072.9</td>
<td align="right">0.0</td>
<td align="right">1230.1</td>
</tr>
<tr class="odd">
<td align="left">UTA</td>
<td align="right">835.7</td>
<td align="right">2002.8</td>
<td align="right">1911.4</td>
<td align="right">1228.9</td>
<td align="right">0.0</td>
</tr>
</tbody>
</table>
<p>So Portland Trail Blazers and Oklahoma City Thunder have a driving travel distance of over 3000 km. That’s a similar distance as from London to Longyearbyen on Svalbard.</p>
</div>
<div id="travel-time-lookup" class="section level2">
<h2>Travel time lookup</h2>
<p>We can also create a team-to-team lookup for travel time.</p>
<pre class="r"><code>nba_travel$Time %&gt;%
  left_join(nba_lookup, by = c(&quot;or&quot; = &quot;Search&quot;)) %&gt;% 
  left_join(
    nba_lookup, by = c(&quot;de&quot; = &quot;Search&quot;), suffix = c(&quot; (origin)&quot;, &quot; (destination)&quot;)
  ) %&gt;% 
  mutate(Time = round(Time/60/60), 1) %&gt;% # s to hrs
  select(`Team code (origin)`, `Team code (destination)`, Time) %&gt;% 
  spread(key = `Team code (destination)`, value = Time) %&gt;% 
  rename(`Travel time (hours)` = `Team code (origin)`) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Travel time (hours)</th>
<th align="right">DEN</th>
<th align="right">MIN</th>
<th align="right">OKC</th>
<th align="right">POR</th>
<th align="right">UTA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DEN</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">10</td>
<td align="right">18</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">MIN</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">11</td>
<td align="right">25</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">OKC</td>
<td align="right">10</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">28</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">POR</td>
<td align="right">18</td>
<td align="right">25</td>
<td align="right">27</td>
<td align="right">0</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">UTA</td>
<td align="right">8</td>
<td align="right">18</td>
<td align="right">17</td>
<td align="right">11</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>So more than half a day’s drive for many of the journeys and more than a day’s drive between Portland and Oklahoma City.</p>
</div>
</div>
<div id="recap" class="section level1">
<h1>Recap</h1>
<p>We:</p>
<ol style="list-style-type: decimal">
<li><a href="https://cloud.google.com/maps-platform/">Got an API key</a></li>
<li>Scraped and wrangled data <a href="https://CRAN.R-project.org/package=gmapsdistance">with <code>rvest</code></a> and other packages</li>
<li>Mapped it with <a href="https://cran.r-project.org/web/packages/leaflet/index.html">the <code>leaflet</code> package</a></li>
<li>Queried the Google Maps API <a href="https://CRAN.R-project.org/package=gmapsdistance">with <code>gmapsdistance</code></a></li>
<li>Summarised the output</li>
<li>Were impressed by the thought of any of these team’s fans actually driving these distances</li>
</ol>
</div>
